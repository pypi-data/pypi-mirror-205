"use strict";(self.webpackChunkinteractivede=self.webpackChunkinteractivede||[]).push([[640],{640:(e,t,n)=>{n.r(t),n.d(t,{default:()=>fe});var s=n(123),r=n(597);function a(e){return"object"==typeof e?`<pre>${JSON.stringify(e,null,2)}</pre>`:e}class o{static get changed(){return this.events.changed}static log(e,t){const{data:n=null,level:s="info"}=t||{};this.events.push({type:"html",level:s,date:(new Date).toISOString(),event:e,extra:n,data:`${e}${n?` <strong>:</strong> ${a(n)}`:""}`})}static print(e=!0){e?console.table(this.events):console.log({logEvents:this.events})}}o.events=new r.ObservableList({values:[{type:"html",level:"info",date:(new Date).toISOString(),data:"Initialized Logging",event:"Initialized Logging"}]});var i=n(113),l=n(526),c=n(191),d=n(840);class u{constructor(){this._isDisposed=!1}get isDisposed(){return this._isDisposed}set isDisposed(e){this._isDisposed=e}}class g{constructor(){this._ctx=null}init(e){e.currentChanged.connect((async(e,t)=>{t&&(this._ctx=t.sessionContext)}))}async execute(e){return new Promise((t=>{var n,s;const r=null===(s=null===(n=this._ctx)||void 0===n?void 0:n.session)||void 0===s?void 0:s.kernel;if(!r)return void t({status:"error",err:new Error("No kernel found")});const a={status:"ok",content:[]},o=r.requestExecute({code:e,stop_on_error:!0,store_history:!1});o.onIOPub=e=>{const t=e.header.msg_type,n=e.content;let s="";switch(t){case"execute_result":case"display_data":case"update_display_data":s+=n.data["text/plain"]||"";break;case"stream":s+=n.text}a.content.push(...s.split("\n").filter((e=>e.length>0)))},o.done.then((e=>{const n=e.content.status;t("ok"!==n?{status:n,err:e.content}:a)})).catch((e=>{console.warn("Execution failed",e),t({status:"error",err:e})}))}))}}!function(e){e.withIDE=function(e){return`import interactivede.ide as IDE\n${e}`},e.withJson=function(e){return`import json\n${e}`},e.withPandas=function(e){return`import pandas as pd\n${e}`}}(g||(g={}));class h{}h.cells=new Map,h.vegaManager=new WeakMap,h.cellUpdateStatus=new WeakMap,h.executor=new g,h.Datasets={counter:{selection:-1,filter:-1,root:-1},datasetStatusMap:new Map},window.IDEGlobal=h;var p,m=n(791);function v(e){return"function"==typeof e?e():e}async function _(e,t,n){return Promise.resolve(e.apply(t,n))}function f(e){const t=m.Registry.create(),n=t.register("interaction",((e,t)=>{e.interactions.push(t)}));let s=(0,m.initializeTrrack)({registry:t,initialState:{interactions:[]}});return e&&"string"==typeof e?s.import(e):e&&"string"!=typeof e&&(s=(0,m.initializeTrrack)({registry:t,initialState:e})),{trrack:s,actions:{addIntervalSelection:async(e,t="Brush Selection")=>await _(s,v(t),n(e)),addSingleSelection:async(e,t="Point Selection")=>await _(s,v(t),n(e)),addFilter:async(e,t="Filter")=>await _(s,v(t),n(e)),addAggregate:async(e,t="Aggregate")=>await _(s,v(t),n(e))}}}class C{static create(e){return f(e)}}!function(e){e.create=function(e){return f(e)}}(p||(p={}));const w="trrack_graph";class k extends u{constructor(e){super(),this._cell=e,this._trrackInstanceChange=new d.Signal(this),this._trrackCurrentChange=new d.Signal(this);const{trrack:t,actions:n}=this._reset(!0);this._trrack=t,this._actions=n}get savedGraph(){var e;const t=null===(e=this._cell.model.metadata)||void 0===e?void 0:e.get(w);return"string"==typeof t?t:JSON.stringify(t)}get trrack(){return this._trrack}get actions(){return this._actions}get isAtRoot(){return this.current===this.root}get isAtLatest(){return 0===this._trrack.current.children.length}get hasOnlyRoot(){return 0===this._trrack.root.children.length}get changed(){return this._trrackInstanceChange}get currentChange(){return this._trrackCurrentChange}get root(){return this._trrack.root.id}get current(){return this._trrack.current.id}_cleanUpDatasets(){const e=this._trrack.graph.backend.nodes;Object.keys(e).forEach((e=>{h.Datasets.datasetStatusMap.delete(e)}))}_reset(e){this._trrack&&this._cleanUpDatasets(),this.currentChange.disconnect(this._saveTrrackGraphToModel,this);const{trrack:t,actions:n}=C.create(e?this.savedGraph:void 0);return this._trrack=t,this._actions=n,this._saveTrrackGraphToModel(),this._trrack.currentChange((e=>{this._trrackCurrentChange.emit({trigger:e,currentNode:this._trrack.current.id,state:this._trrack.getState()})})),this.currentChange.connect(this._saveTrrackGraphToModel,this),this._trrackInstanceChange.emit(this._trrack.root.id),this._trrackCurrentChange.emit({trigger:"reset",currentNode:this._trrack.current.id,state:this._trrack.getState()}),{trrack:t,actions:n}}_saveTrrackGraphToModel(){this._cell.model.metadata.set(w,JSON.parse(this._trrack.export()))}reset(){this._reset(!1)}dispose(){this.isDisposed||(this.isDisposed=!0,d.Signal.clearData(this))}}const y=i.VEGALITE4_MIME_TYPE,x="trrack_execution_spec";class b extends c.CodeCell{constructor(e){super(e),this._trrackManager=new k(this),this.model.outputs.fromJSON(this.model.outputs.toJSON()),this.model.outputs.changed.connect(this._outputChangeListener,this),o.log(`Created TrrackableCell ${this.cellId}`)}dispose(){this.isDisposed||(d.Signal.clearData(this),h.cells.delete(this.cellId),this._trrackManager.dispose(),super.dispose())}get cellId(){return this.model.id}get trrackId(){return this._trrackManager.root}get trrackManager(){return this._trrackManager}get executionSpec(){return this.model.metadata.get(x)}addSpecToMetadata(e){"execute"===h.cellUpdateStatus.get(this)&&this.model.metadata.set(x,e)}updateVegaSpec(e){const t=this.model.outputs.toJSON().findIndex((e=>"execute_result"===e.output_type));if(-1===t)return;const n=this.model.outputs.get(t);"execute_result"===n.type&&(h.cellUpdateStatus.set(this,"update"),n.setData({data:{[y]:e}}))}_outputChangeListener(e,t){const{type:n,newIndex:s}=t;if("add"!==n)return;const r=e.get(s),a=r.metadata;"execute_result"!==r.type||a.cellId||(h.cellUpdateStatus.set(this,"execute"),r.setData({metadata:{cellId:this.cellId}}))}}!function(e){e.create=function(t){const n=new e(t);return h.cells.set(n.cellId,n),n},e.isTrrackableCell=function(t){return t instanceof e}}(b||(b={}));var S=n(86),I=n(832),E=n(33),L=n(271),R=n.n(L),M=n(936),A=n(17),D=n(456),T=n.n(D),O=n(502);function W(e){return R().createElement("div",{onClick:e=>e.stopPropagation(),style:{zIndex:100,display:"flex",flexDirection:"row"}},R().createElement("button",{className:"bp3-button bp3-minimal jp-ToolbarButtonComponent minimal jp-Button",type:"button",onClick:async t=>{var n;t.preventDefault();const s=(null===(n=e.cell.trrackManager.trrack.metadata.latestOfType(j,e.id))||void 0===n?void 0:n.val)||"";0!==s.length&&(await navigator.clipboard.writeText(`IDE.DataFrameStorage.get("${s}")`),E.Notification.emit(`Copied code for df: ${s}`,"success",{autoClose:500}))}},R().createElement(O.copyIcon.react,{tag:"span"})))}function N(e){const{cell:t}=e,n=t.trrackManager,{trrack:s}=n,[r,a]=(0,L.useState)(s.current.id),o=(0,L.useRef)(null),{verticalSpace:i,marginTop:l,gutter:c}={verticalSpace:25,marginTop:25,gutter:25};return(0,L.useEffect)((()=>{const e=(e,{currentNode:t})=>{a(t)};return n.currentChange.connect(e),()=>{n.currentChange.disconnect(e)}}),[n]),(0,L.useEffect)((()=>{const e=o.current;if(!e)return;const n=(0,A.Z)(e).selectAll(".node-description").selectAll(".extract-btn").data([null]).join("div").classed("extract-btn",!0),s=[];return n.each((function(){const e=this;if(!e)return;const n=(0,A.Z)(e.parentElement).attr("data-node-id");s.push((()=>T().unmountComponentAtNode(e))),T().render(R().createElement(W,{cell:t,id:n}),e)})),()=>s.forEach((e=>e()))})),R().createElement("div",{ref:o},R().createElement(M.ProvVis,{root:s.root.id,config:{changeCurrent:e=>{s.to(e)},labelWidth:100,verticalSpace:i,marginTop:l,marginLeft:15,gutter:c,animationDuration:200},nodeMap:s.graph.backend.nodes,currentNode:r}))}const j="df_name";function V(e){return R().createElement(E.UseSignal,{signal:e.cellChange},((e,t)=>t?R().createElement(N,{cell:t}):null))}class U extends E.ReactWidget{constructor(){super(...arguments),this._cell=null,this._cellChange=new d.Signal(this)}async tryRender(e){this.show();const t=h.cells.get(e);if(!t)throw new Error("Cell not found");t!==this._cell&&(this._cell=t,this._cellChange.emit(this._cell))}render(){return R().createElement(V,{cellChange:this._cellChange})}}const H="jp-OutputHeaderWidget-btn";function $(e){const{commands:t,cId:n}=e;return t.hasCommand(n)?R().createElement(E.UseSignal,{signal:t.commandChanged},(()=>R().createElement(O.Button,{className:H,disabled:!t.isEnabled(n),onClick:()=>t.execute(n)},t.label(n)))):(console.warn(`Command ${n} not found`),null)}var P,F=n(57);!function(e){e.reset="output:reset",e.filter="output:filter",e.aggregate="output:aggregate"}(P||(P={}));class J{constructor(e){this._cell=e,this._commands=new F.CommandRegistry,this._cell&&this._setup()}get commands(){return this._commands}_setup(){this._commands.addCommand(P.reset,{execute:()=>{this._cell.trrackManager.reset()},isEnabled:()=>!this._cell.trrackManager.hasOnlyRoot,label:"Reset"}),this._commands.addCommand(P.filter,{execute:()=>{!async function(e){await e.trrackManager.actions.addFilter({id:l.UUID.uuid4(),type:"filter"})}(this._cell)},label:"Filter"}),this._commands.addCommand(P.aggregate,{execute:()=>{!async function(e){await e.trrackManager.actions.addAggregate({id:l.UUID.uuid4(),type:"aggregate"})}(this._cell)},label:"Aggregate"}),this._cell.trrackManager.currentChange.connect(((e,t)=>{this._commands.notifyCommandChanged()}))}}const B=[P.reset,P.filter];function z(e){const[t,n]=(0,L.useState)(null),s=(0,L.useMemo)((()=>t?new J(t):null),[t]);return(0,L.useEffect)((()=>{const t=(e,t)=>{n(t)};return e.cellChange.connect(t),()=>{e.cellChange.disconnect(t)}}),[e.cellChange]),s?R().createElement(R().Fragment,null,B.map((e=>R().createElement($,{commands:s.commands,cId:e})))):null}class G extends E.ReactWidget{constructor(){super(),this._cellChange=new d.Signal(this),this.addClass("jp-OutputHeaderWidget")}associateCell(e){this.show(),this._cellChange.emit(e)}toggle(){return this.isHidden?this.show():this.hide(),this.isHidden}render(){return this.show(),R().createElement(z,{cellChange:this._cellChange})}}class q extends S.RenderedCommon{constructor(e){super(e),this.outputHeaderWidget=new G,this.outputArea=new I.Panel,this.trrackVisWidget=new I.Panel,this.layout=this._panelLayout=new I.PanelLayout,this.addClass("lm-Panel"),this.addClass("jp-trrack-OutputArea-output"),this._setupOutputHeaderWidget(),this._createRenderer=()=>this.createRenderer(e),this._executeResultRenderer=this._createRenderer(),this._setupExecuteResultWidget(),this._trrackVisRenderer=new U,this._setupTrrackWidget(),this._panelLayout.addWidget(this.outputHeaderWidget),this._panelLayout.addWidget(this.outputArea),this._panelLayout.addWidget(this.trrackVisWidget)}get executeResultRenderer(){return this._executeResultRenderer}_setupOutputHeaderWidget(){this.outputHeaderWidget.addClass("jp-gridArea-OutputArea-head")}_setupExecuteResultWidget(){this.outputArea.id="regular",this.outputArea.addClass("jp-gridArea-OutputArea-output"),this.outputArea.addClass("jp-trrack-OutputArea-executeResult"),this.outputArea.addClass("jp-OutputArea-output"),this.outputArea.addClass("enable-scroll")}_setupTrrackWidget(){this.trrackVisWidget.id="trrack",this.trrackVisWidget.addClass("jp-gridArea-OutputArea-trrack"),this.trrackVisWidget.addClass("jp-trrack-OutputArea-trrack"),this.trrackVisWidget.addWidget(this._trrackVisRenderer)}async renderModel(e){this.toggleClass("jp-mod-trusted",e.trusted),await this.render(e);const{fragment:t}=e.metadata||{};t&&this.setFragment(t)}async render(e){var t,n;const s=this._createRenderer(),r=await s.renderModel(e);for(;this.outputArea.widgets.length>0;)this.outputArea.layout.widgets[0].dispose(),this.outputArea.layout.removeWidgetAt(0);this.outputArea.node.textContent="",this.outputArea.addWidget(s),this._executeResultRenderer.dispose(),this._executeResultRenderer=s;const a=null===(t=e.metadata)||void 0===t?void 0:t.cellId;a||(console.warn("Cell id not found in metadata for following element. Consider not using RenderedTrrackOutput"),console.warn(this.node));const o=a?h.cells.get(a):null;return a&&o&&this._trrackVisRenderer?(this.outputHeaderWidget.associateCell(o),await this._trrackVisRenderer.tryRender(a),await this.postRender(o)):(this.outputHeaderWidget.hide(),null===(n=this._trrackVisRenderer)||void 0===n||n.hide()),r}dispose(){super.dispose(),this._executeResultRenderer.dispose(),this._trrackVisRenderer.dispose(),this.outputHeaderWidget.dispose()}}function K(e,t,n){return e.fields=t||[],e.fname=n,e}function Y(e){return 1===e.length?Z(e[0]):X(e)}const Z=e=>function(t){return t[e]},X=e=>{const t=e.length;return function(n){for(let s=0;s<t;++s)n=n[e[s]];return n}};function Q(e){throw Error(e)}function ee(e){return"mark"in e}function te(e){return JSON.parse(JSON.stringify(e))}function ne(e){return"interval"===(null==e?void 0:e.type)}var se;(function(e,t,n){const s=function(e){const t=[],n=e.length;let s,r,a,o=null,i=0,l="";function c(){t.push(l+e.substring(s,r)),l="",s=r+1}for(e+="",s=r=0;r<n;++r)if(a=e[r],"\\"===a)l+=e.substring(s,r),l+=e.substring(++r,++r),s=r;else if(a===o)c(),o=null,i=-1;else{if(o)continue;s===i&&'"'===a||s===i&&"'"===a?(s=r+1,o=a):"."!==a||i?"["===a?(r>s&&c(),i=s=r+1):"]"===a&&(i||Q("Access path missing open bracket: "+e),i>0&&c(),i=0,s=r+1):r>s?c():s=r+1}return i&&Q("Access path missing closing bracket: "+e),o&&Q("Access path missing closing quote: "+e),r>s&&(r++,c()),t}(e);e=1===s.length?s[0]:e,K((n&&n.get||Y)(s),[e],t||e)})("id"),K((e=>e),[],"identity"),K((()=>0),[],"zero"),K((()=>1),[],"one"),K((()=>!0),[],"true"),K((()=>!1),[],"false"),Array.isArray,Object.prototype.hasOwnProperty,function(e){let t;!function(e){e.hasX=function(e){return void 0!==e&&"x"in e},e.hasY=function(e){return void 0!==e&&"y"in e},e.is=function(e){return"selection_interval"===e.type},e.init=function({params:e}){const t=e&&"x"in e&&e.x.range,n=e&&"y"in e&&e.y.range;return t&&n?{x:t,y:n}:t?{x:t}:n?{y:n}:void 0}}(t=e.IntervalSelectionAction||(e.IntervalSelectionAction={}))}(se||(se={}));class re{constructor(e){this.interactions=e}apply(e){re.cache.has(e)||re.cache.set(e,new Map);const t=re.cache.get(e);return this.interactions.forEach((n=>{e=this.applyInteraction(e,n,t)})),e}applyInteraction(e,t,n){if(n.has(t))return console.log("Cache"),n.get(t);let s;switch(t.type){case"filter":s=this.applyFilter(te(e));break;case"selection_interval":s=this.applySelectionInterval(te(e),te(t));break;default:s=e}return n.set(t,s),s}applySelectionInterval(e,t){e.usermeta||(e.usermeta={__ide__:t}),e.usermeta.__ide__=t;const n=se.IntervalSelectionAction.init(t);return n?e.selection[t.name].init=n:ee(e)&&delete e.selection[t.name].init,e}applyFilter(e){if(ee(e)){const t=e.selection||{},n=e.transform||[];Object.entries(t).forEach((([t,s])=>{if(ne(s)){const t=function(e,t){const n=[],{init:s,encodings:r=[]}=t;if(!s)return n;const{params:a}=e.usermeta.__ide__;return a?("x"in a&&(0===r.length||r.includes("x"))&&n.push({field:a.x.field,range:a.x.range}),"y"in a&&(0===r.length||r.includes("y"))&&n.push({field:a.y.field,range:a.y.range}),n):n}(e,s);n.push({filter:{not:{and:t}}})}delete e.selection[t].init})),e.transform=n}return e}}re.cache=new Map;class ae extends u{constructor(e,t,n){super(),this._view=e,this._id=t,this._listener=n,this.add()}pause(){return this.remove(),this}resume(){if(this.isDisposed)throw new Error(`Handler for ${this._id} is disposed`);return this.add(),this}dispose(){this.isDisposed||(this.isDisposed=!0,this.remove())}}class oe extends ae{constructor(e,t,n){super(e,t,n)}add(){return this._view.addSignalListener(this._id,this._listener),this}remove(){return this._view.removeSignalListener(this._id,this._listener),this}}class ie extends ae{constructor(e,t,n){super(e,t,n)}add(){return this._view.addEventListener(this._id,this._listener),this}remove(){return this._view.removeEventListener(this._id,this._listener),this}}class le extends u{constructor(e,t){super(),this._cell=e,this._vega=t,this._listeners={selection:new Set},this._tManager.currentChange.connect(((e,t)=>{this.update()}),this),this._processVegaSpec()}update(){const e=te(this._cell.executionSpec);if(!e)throw new Error("No execution spec found for cell");const t=this._tManager.trrack.getState().interactions,n=new re(t).apply(e);this._cell.updateVegaSpec(n)}dispose(){this.isDisposed||(this.isDisposed=!0,this.removeListeners(),this.view.finalize(),d.Signal.disconnectAll(this))}get _cellId(){return this._cell.cellId}get _tManager(){return this._cell.trrackManager}get hasVega(){return!!this.view}get vega(){return this._vega}get view(){return this._vega.view}get spec(){return this._vega.spec}_processVegaSpec(){this.addListeners()}addListeners(){this.addSelectionListeners()}addSelectionListeners(){this.removeSelectionListeners();const e=this.spec;ee(e)&&e.selection&&Object.keys(e.selection).forEach((t=>{if(ne(e.selection&&e.selection[t])){const e=function({manager:e,selector:t,trrackManager:n,cellId:s}){const r=`/selection/${t}`,{view:a}=e;if(r||a||console.log(""),!h.cells.get(s))throw new Error("Cell doesn't exist");const o={},i=a.getState({signals:(e,t)=>void 0!==e&&(null==e?void 0:e.includes("_tuple_fields"))}).signals[`${t}_tuple_fields`]||[],c=i.filter((e=>"x"===e.channel)),d=i.filter((e=>"y"===e.channel)),u=1===c.length?c[0].field:void 0,g=1===d.length?d[0].field:void 0;let p=!1;return{handleSignalChange:function(e,t){p=!0;const n=u?t[u]:null,s=g?t[g]:null;n&&u&&(o.x={field:u,range:n}),s&&g&&(o.y={field:g,range:s})},handleBrushEnd:async function(e,s){if(!p)return;p=!1;const a=o.x||o.y?o:void 0,i={id:l.UUID.uuid4(),type:"selection_interval",name:t,path:r,params:a};await n.actions.addIntervalSelection(i,a?"Brush selection":"Clear Selection")}}}({manager:this,selector:t,trrackManager:this._tManager,cellId:this._cellId});this._listeners.selection.add(new oe(this.view,t,e.handleSignalChange)),this._listeners.selection.add(new ie(this.view,"mouseup",e.handleBrushEnd))}}))}removeListeners(){this.removeSelectionListeners()}removeSelectionListeners(){this._listeners.selection.forEach((e=>e.dispose()))}}!function(e){e.create=function(t,n){const s=new e(t,n),r=h.vegaManager.get(t);return r&&r.dispose(),h.vegaManager.set(t,s),s}}(le||(le={}));class ce extends q{constructor(e){super(e),this._id=Math.random()}createRenderer(e){return new i.RenderedVega(e)}dispose(){super.dispose(),this._unsafeVegaAccess&&this._vega.view.finalize()}postRender(e){const t=le.create(e,this._vega);return e.addSpecToMetadata(this.spec),"execute"===h.cellUpdateStatus.get(e)&&t.update(),Promise.resolve()}async renderModel(e){return await super.renderModel(e)}get _unsafeVegaAccess(){var e;return Boolean(null===(e=this.executeResultRenderer)||void 0===e?void 0:e._result)}get _vega(){var e;if(!this._unsafeVegaAccess)throw new Error("Vega object not yet created! Should only be accessed by vega manager created from postRender.");return null===(e=this.executeResultRenderer)||void 0===e?void 0:e._result}get spec(){return this._vega.spec}}const de="NB_UUID";class ue{constructor(e){h.executor.init(e),e.currentChanged.connect(((e,t)=>{t&&o.log(`Switched to notebook: ${null==t?void 0:t.context.path}`),null==t||t.context.ready.then((()=>{const e=t.context.model.metadata.get(de);if(e)h.currentNotebook=e;else{const e=l.UUID.uuid4();t.context.model.metadata.set(de,e),h.currentNotebook=e}})),null==t||t.disposed.connect((()=>{o.log(`Closed notebook: ${null==t?void 0:t.context.path}`)}))}))}createNew(e,t){e.content.rendermime.addFactory({...i.rendererFactory,defaultRank:(i.rendererFactory.defaultRank||10)-1,createRenderer:e=>new ce(e)}),e.content,s.NotebookActions.executed.connect(((e,{cell:t,notebook:n})=>{b.isTrrackableCell(t)&&o.log(`Cell ${t.cellId} executed in notebook ${n.id}`)})),s.NotebookActions.executionScheduled.connect(((e,{cell:t})=>{b.isTrrackableCell(t)}))}}const ge={id:"interactivede:plugin",autoStart:!0,requires:[s.INotebookTracker],activate:function(e,t){e.docRegistry.addWidgetExtension("notebook",new ue(t)),o.log("JupyterLab extension interactivede is activated!")}};class he extends s.NotebookPanel.ContentFactory{createCodeCell(e,t){return b.create(e).initializeState()}}const pe={id:"interactivede:cell-factory",provides:s.NotebookPanel.IContentFactory,autoStart:!0,activate:()=>(o.log("Jupyterlab extension interactivede is activated! - cell-factory"),new he)};var me=n(687),ve=n(39);class _e extends E.ReactWidget{constructor(e){super(),this.handleChange=e=>{this._logConsole.logger&&(this._logConsole.logger.level=e.target.value),this.update()},this.handleKeyDown=e=>{13===e.keyCode&&this._logConsole.activate()},this._id=`level-${l.UUID.uuid4()}`,this.addClass("jp-LogConsole-toolbarLogLevel"),this._logConsole=e,this._logConsole.logger.level="debug",e.source&&this.update(),e.sourceChanged.connect(this._updateSource,this)}_updateSource(e,{oldValue:t,newValue:n}){null!==t&&e.loggerRegistry.getLogger(t).stateChanged.disconnect(this.update,this),null!==n&&e.loggerRegistry.getLogger(n).stateChanged.connect(this.update,this),this.update()}render(){const e=this._logConsole.logger;return R().createElement(R().Fragment,null,R().createElement("label",{htmlFor:this._id,className:null===e?"jp-LogConsole-toolbarLogLevel-disabled":void 0},"Log Level:"),R().createElement(O.HTMLSelect,{id:this._id,className:"jp-LogConsole-toolbarLogLevelDropdown",onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:null==e?void 0:e.level,"aria-label":"Log level",disabled:null===e,options:null===e?[]:["Critical","Error","Warning","Info","Debug"].map((e=>({label:e,value:e.toLowerCase()})))}))}}const fe=[ge,pe,{id:"interactivede:log-console",autoStart:!0,requires:[E.ICommandPalette,S.IRenderMimeRegistry,me.ILayoutRestorer],activate:(e,t,n,s)=>{const{commands:r}=e;let a=null,i=null;const l=new E.WidgetTracker({namespace:"log-console"});s.restore(l,{command:"lg/log-console:open",name:()=>"Log Console"}),r.addCommand("lg/log-console:checkpoint",{execute:()=>{var e;return null===(e=null==a?void 0:a.logger)||void 0===e?void 0:e.checkpoint()},icon:O.addIcon,isEnabled:()=>!!a&&null!==a.source,label:"Add Checkpoint"}),r.addCommand("lg/log-console:clear",{execute:()=>{var e;return null===(e=null==a?void 0:a.logger)||void 0===e?void 0:e.clear()},icon:O.clearIcon,isEnabled:()=>!!a&&null!==a.source,label:"Clear Log"}),e.commands.addCommand("lg/log-console:download",{execute:()=>{if(!document)return;const e=[];for(let t=0;t<o.events.length;++t){const n=o.events.get(t),s={event:n.event,date:n.date};n.extra&&(s.extra=n.extra),e.push(s)}const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=document.createElement("a");n.download=`IDE_JP_ext_log_${Date.now()}.json`,n.href=window.URL.createObjectURL(t),n.dataset.downloadUrl=["application/json",n.download,n.href].join(":");const s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(s),n.remove()},icon:O.downloadIcon,isEnabled:()=>o.events.length>0,label:"Download Log"}),r.addCommand("lg/log-console:level",{execute:e=>{(null==a?void 0:a.logger)&&(a.logger.level=e.level)},isEnabled:()=>!!a&&null!==a.source,label:e=>`Set Log Level to ${e.level}`}),r.addCommand("lg/log-console:open",{label:"Open Log Console",caption:"Open log console.",isToggled:()=>null!==i,execute:()=>{i?i.dispose():(()=>{var t,s,c;a=new ve.LogConsolePanel(new ve.LoggerRegistry({defaultRendermime:n,maxLength:1e3})),a.source="IDE Logs",i=new E.MainAreaWidget({content:a}),i.addClass("jp-LogConsole"),i.title.label="Log Console",i.title.icon=O.listIcon,i.toolbar.addItem("checkpoint",new E.CommandToolbarButton({commands:e.commands,id:"lg/log-console:checkpoint"})),i.toolbar.addItem("download",new E.CommandToolbarButton({commands:e.commands,id:"lg/log-console:download"})),i.toolbar.addItem("level",new _e(i.content));const d=(e,t)=>{"add"===t.type&&t.newValues.forEach((e=>{var t,n,s;switch(e.type){case"text":null===(t=null==a?void 0:a.logger)||void 0===t||t.log(e);break;case"output":null===(n=null==a?void 0:a.logger)||void 0===n||n.log(e);break;case"html":null===(s=null==a?void 0:a.logger)||void 0===s||s.log(e)}}))};i.disposed.connect((()=>{i=null,a=null,o.changed.disconnect(d,void 0),r.notifyCommandChanged()})),e.shell.add(i,"main",{mode:"split-bottom"}),l.add(i);for(let e=0;e<o.events.length;++e){const n=o.events.get(e);switch(n.type){case"text":null===(t=null==a?void 0:a.logger)||void 0===t||t.log(n);break;case"output":null===(s=null==a?void 0:a.logger)||void 0===s||s.log(n);break;case"html":null===(c=null==a?void 0:a.logger)||void 0===c||c.log(n)}}o.changed.connect(d,void 0),i.update(),r.notifyCommandChanged()})()}}),t.addItem({command:"lg/log-console:open",category:"Log Console"}),r.addCommand("lg/log-console:logHTMLMessage",{label:"HTML log message",caption:"HTML log message.",execute:()=>{var e;null===(e=null==a?void 0:a.logger)||void 0===e||e.log({type:"html",level:"debug",data:"<div>Hello world HTML!!</div>"})}}),r.addCommand("lg/log-console:logTextMessage",{label:"Text log message",caption:"Text log message.",execute:()=>{var e;null===(e=null==a?void 0:a.logger)||void 0===e||e.log({type:"text",level:"info",data:"Hello world text!!"})}}),r.addCommand("lg/log-console:logOutputMessage",{label:"Output log message",caption:"Notebook output log message.",execute:()=>{var e;null===(e=null==a?void 0:a.logger)||void 0===e||e.log({type:"output",level:"warning",data:{output_type:"display_data",data:{"text/plain":"Hello world nbformat!!"}}})}})}}]}}]);