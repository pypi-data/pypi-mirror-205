{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Subnetwork",
    "description": "Subnetwork of stations deployed by an OBS operator within a FDSN network $comment: No $id (or id) yet: should be set to a URL at a domain we control (e.g. http://www.ipgp.fr/~crawford/json-schemas/network.schema.json",
    "type": "object",
    "required": ["format_version", "subnetwork"],
    "properties": {
        "format_version": {"$ref" : "definitions.schema.json#/format_version"},
        "revision":       {"$ref": "definitions.schema.json#/revision"},
        "yaml_anchors":   {"$ref": "definitions.schema.json#/yaml_anchors"},
        "notes" :         {"$ref": "definitions.schema.json#/note_list"},
        "subnetwork":     {"$ref": "#/definitions/subnetwork"}
    },
    "additionalProperties" : false,
    "definitions" : {
        "subnetwork": {
            "type": "object",
            "required": [
                "operators",
                "network",
                "stations"
            ],
            "properties": {
                "operators":         {"$ref": "operator.schema.json#/definitions/operators"},
                "reference_names":   {"$ref": "#/definitions/reference_names"},
                "network":           {"$ref": "network.schema.json#/definitions/network"},
                "stations":          {"$ref": "#/definitions/stations_map"},
                "comments":          {"$ref": "definitions.schema.json#/comments"},
                "extras":            {"$ref": "definitions.schema.json#/extras" }
            },
            "additionalProperties" : false
        },
        "reference_names": {
            "type": "object",
            "properties": {
                "campaign":  {"$ref": "definitions.schema.json#/reference_name"},
                "operator":  {"$ref": "definitions.schema.json#/reference_name"}
            },
            "additionalProperties": false
        },
        "stations_map" : {
            "type": "object",
            "description": "Seafloor seismological stations, keys are station names",
            "$comment": "If we use draft-06, 'patternProperties' should probably be replaced by 'propertyNames':{'pattern':}",
            "patternProperties": {
                "^[A-Za-z0-9_-]+$": {"$ref": "#/definitions/station" }
            },
            "additionalProperties": false
        },
        "station" : {
            "type" : "object",
            "description" : "OBS station",
            "required": [
                "site",
                "start_date",
                "end_date",
                "locations",
                "location_code"
            ],
            "properties": {
                "site":                {"type": "string", "minLength" : 1},
                "end_date":            {"$ref": "definitions.schema.json#/date-time-Z"},
                "start_date":          {"$ref": "definitions.schema.json#/date-time-Z"},
                "location_code":       {"$ref": "#/definitions/location_code"},
                "locations":           {"$ref": "#/definitions/locations_map"},
                "instrumentation":     {"$ref": "instrumentation_base.schema.json#/definitions/instrumentation"}, 
                "instrumentations":    {"$ref": "#/definitions/instrumentation_list"}, 
                "operators":           {"$ref": "operator.schema.json#/definitions/operators"},
                "processing":          {"$ref": "#/definitions/processing_list"},
                "notes" :              {"$ref": "definitions.schema.json#/note_list"},
                "comments":            {"$ref" : "definitions.schema.json#/comments"},
                "extras":              {"$ref" : "definitions.schema.json#/extras"},
                "source_id":           {"$ref": "definitions.schema.json#source_id"},
                "external_references": {"$ref": "definitions.schema.json#external_references"},
                "identifiers":         {"$ref": "definitions.schema.json#identifiers"},
                "water_level.m":       {"type": "number"},
                "description":         {"type": "string"},
                "restricted_status":   {"$ref": "definitions.schema.json#/restricted_status"}
            },
            "additionalProperties": false
        },
        "location_code" : {
            "type" : "string",
            "description" : "SEED location code",
            "pattern" : "^[0-9]{2}$"
        },
        "locations_map" : {
            "type" : "object",
            "description" : "sensor position by location code (two digits)",
            "patternProperties": {
                "^[0-9]{2}$": { "$ref": "location_base.schema.json#/definitions/location" }
            }
        },
        "instrumentation_list": {
           "type": "array",
           "description":" list of instrumentation",
           "minItems" : 1,
           "items" : {"$ref": "instrumentation_base.schema.json#/definitions/instrumentation"}
        },
                
        "processing_list": {
            "type": "array",
            "description": "other information",
            "items": {
                "type": "object",
                "description": "other informations that will be appear as comments ",
                "properties": {
                    "clock_correction_linear": {"$ref": "timing_base.schema.json#/definitions/timing"},
                    "clock_correction_leapsecond":   {"$ref": "#/definitions/clock_correction_leapsecond"}
                },
                "additionalProperties" : false
            }
        },
        "clock_correction_leapsecond" : {
                "type" : "object",
                "description" : "Leap-second information",
                "required" : ["time", "type", "corrected_in_end_sync"],
                "properties" : {
                    "time" :                 {"$ref": "definitions.schema.json#/date-time-Z" },
                    "type" :                 {"$ref": "#/definitions/lpsec_type"},
                    "description" :          {"$ref": "#/definitions/lpsec_description" },
                    "corrected_in_end_sync": {"$ref": "#/definitions/lpsec_corrected_in_end_sync"},
                    "corrected_in_basic_miniseed": {"$ref": "#/definitions/lpsec_corrected_in_basic_miniseed" }
                },
                "additionalProperties": false
        },
       "lpsec_type" : {
            "type" : "string",
            "description" : "Leapsecond direction",
            "enum" : ["+","-"]
        },
        "lpsec_description" : {
            "type": "string",
            "enum": [
                "Positive leapsecond (a 61-second minute)",
                "Negative leapsecond (a 59-second minute)"
            ]
        },
        "lpsec_corrected_in_end_sync" : {
            "type": "boolean",
            "description": "True if end_sync_instrument was corrected for the leap second (subtracted one second if positive leapsecond, added one if negative)"
        },
        "lpsec_corrected_in_basic_miniseed" : {
            "type": "boolean",
            "description": "True if basic miniseed data is already corrected for the leap second"
        }
    }
}
