{"version":3,"file":"log_bundle.17e66439d0bc1362bd21.js?v=17e66439d0bc1362bd21","mappings":"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","sources":["webpack://jupyterlab_hai_platform_ext/./node_modules/@hai-platform/logger/build/log-bundle.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport Config from './global-config';\nimport { invokeInQueue } from './hf-operation-queue';\nimport { ResultMsg } from './interface';\nimport HFDB, { LOG_DAY_TABLE_PRIMARY_KEY } from './lib/hf-db';\nimport { ONE_DAY_TIME_SPAN, dateFormat2Day, dayFormat2Date } from './lib/utils';\nvar HFDBInstance;\n/**\n * 对日志信息打包生成带回车的字符串\n * @param logItems\n */\nfunction bundleLogItems(logItems) {\n    // 数据较大的情况下比 map+join 略快\n    var res = logItems.reduce(function (curr, item) {\n        curr += \"\" + item.logString;\n        curr += '\\n';\n        return curr;\n    }, '');\n    return res;\n}\n/**\n * @returns Promise<number> with reported pageIndex if this page has logs, otherwise Promise<null>.\n */\nfunction getLogAndBundle(reportName, reportConfig) {\n    return __awaiter(this, void 0, void 0, function () {\n        var logItems;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, HFDBInstance.getLogsByReportName(reportName)];\n                case 1:\n                    logItems = _a.sent();\n                    console.log('[hflogger] bundle:', logItems.length);\n                    return [2 /*return*/, bundleLogItems(logItems)];\n            }\n        });\n    });\n}\nexport default function getBundleFromDB(reportConfig) {\n    return __awaiter(this, void 0, void 0, function () {\n        var _this = this;\n        return __generator(this, function (_a) {\n            if (!HFDB.idbIsSupported()) {\n                throw new Error(ResultMsg.DB_NOT_SUPPORT);\n            }\n            else {\n                if (!HFDBInstance) {\n                    HFDBInstance = new HFDB(Config.get('dbName'));\n                }\n                return [2 /*return*/, invokeInQueue(function () { return __awaiter(_this, void 0, void 0, function () {\n                        var logDaysInfoList, logReportMap, startDate, endDate, totalLog, logTime, logDay, batchReportResults, e_1;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0: return [4 /*yield*/, HFDBInstance.getLogDaysInfo(reportConfig.fromDayString, reportConfig.toDayString)];\n                                case 1:\n                                    logDaysInfoList = _a.sent();\n                                    logReportMap = logDaysInfoList.reduce(function (acc, logDayInfo) {\n                                        var _a;\n                                        return __assign((_a = {}, _a[logDayInfo[LOG_DAY_TABLE_PRIMARY_KEY]] = logDayInfo.reportPagesInfo\n                                            ? logDayInfo.reportPagesInfo.pageSizes.map(function (i, pageIndex) {\n                                                return HFDBInstance.logReportNameFormatter(logDayInfo[LOG_DAY_TABLE_PRIMARY_KEY], pageIndex);\n                                            })\n                                            : [], _a), acc);\n                                    }, {});\n                                    startDate = dayFormat2Date(reportConfig.fromDayString);\n                                    endDate = dayFormat2Date(reportConfig.toDayString);\n                                    totalLog = '';\n                                    logTime = +startDate;\n                                    _a.label = 2;\n                                case 2:\n                                    if (!(logTime <= +endDate)) return [3 /*break*/, 9];\n                                    logDay = dateFormat2Day(new Date(logTime));\n                                    if (!(logReportMap[logDay] && logReportMap[logDay].length > 0)) return [3 /*break*/, 7];\n                                    _a.label = 3;\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    return [4 /*yield*/, Promise.all(logReportMap[logDay].map(function (reportName) {\n                                            return getLogAndBundle(reportName, reportConfig);\n                                        }))];\n                                case 4:\n                                    batchReportResults = _a.sent();\n                                    totalLog += batchReportResults.join('\\n');\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_1 = _a.sent();\n                                    totalLog += \"[read log db error]\\n\";\n                                    return [3 /*break*/, 6];\n                                case 6: return [3 /*break*/, 8];\n                                case 7:\n                                    totalLog += \"[no log for \" + logTime + \"]\\n\";\n                                    _a.label = 8;\n                                case 8:\n                                    logTime += ONE_DAY_TIME_SPAN;\n                                    return [3 /*break*/, 2];\n                                case 9: return [2 /*return*/, totalLog];\n                            }\n                        });\n                    }); })];\n            }\n            return [2 /*return*/];\n        });\n    });\n}\n"],"names":["HFDBInstance","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","bundleLogItems","logItems","reduce","curr","item","logString","getBundleFromDB","reportConfig","_this","_a","logDaysInfoList","logReportMap","startDate","endDate","totalLog","logTime","logDay","batchReportResults","getLogDaysInfo","fromDayString","toDayString","acc","logDayInfo","reportPagesInfo","pageSizes","map","pageIndex","logReportNameFormatter","Date","all","reportName","getLogsByReportName","console","log","getLogAndBundle","join","Error"],"sourceRoot":""}