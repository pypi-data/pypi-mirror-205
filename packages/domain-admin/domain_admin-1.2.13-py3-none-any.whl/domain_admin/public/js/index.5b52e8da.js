import{S as B,u as P}from"./SelectGroup.540708ea.js";import{_ as D,d as j,r as L}from"./index.46449544.js";import{a5 as r,ak as Y,S as M,o as h,c as v,X as t,R as l,a as p,Z as b,Q as S,V as U,L as Q,W as f,O as W,am as X,ay as Z,az as J,aa as ee}from"./vendor-vue.e07d7f7e.js";import{C as H}from"./ConnectStatus.84e4cb03.js";import{d as F,a as te}from"./element-plus.0d508af4.js";import{F as ae}from"./vendor-lib.f93a8f58.js";import"./element-icon.bb5f2c38.js";const oe={domain:[{message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},le={name:"",props:{row:{type:Object,default:null}},components:{SelectGroup:B},data(){return{loading:!1,rules:oe,form:{domain:"",alias:"",group_id:""}}},computed:{},methods:{async getData(){if(this.loading=!0,this.row){let o={id:this.row.id},i=(await this.$http.getDomainById(o)).data;this.form.domain=i.domain,this.form.alias=i.alias,this.form.group_id=i.group_id,this.form.group_id==0&&(this.form.group_id="")}this.loading=!1},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(o=>{if(o)this.confirmSubmit();else return!1})},async confirmSubmit(){let o=this.$loading({fullscreen:!0}),a={domain:this.form.domain.trim(),alias:this.form.alias.trim(),group_id:this.form.group_id},i=null;this.row?(a.id=this.row.id,i=await this.$http.updateDomainById(a)):i=await this.$http.addDomain(a),i.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(i.msg),this.$nextTick(()=>{o.close()})}},created(){this.getData()}},se={class:"text-center"};function ie(o,a,i,g,s,n){const u=r("el-input"),d=r("el-form-item"),c=r("SelectGroup"),y=r("el-form"),w=r("el-button"),C=Y("loading");return M((h(),v("div",null,[t(y,{ref:"form",model:s.form,rules:s.rules,"label-width":"80px"},{default:l(()=>[t(d,{label:"\u57DF\u540D",prop:"domain"},{default:l(()=>[t(u,{type:"text",modelValue:s.form.domain,"onUpdate:modelValue":a[0]||(a[0]=_=>s.form.domain=_),placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u5206\u7EC4",prop:"group_id"},{default:l(()=>[t(c,{class:"w-[150px]",modelValue:s.form.group_id,"onUpdate:modelValue":a[1]||(a[1]=_=>s.form.group_id=_),clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"\u5907\u6CE8",prop:"alias"},{default:l(()=>[t(u,{type:"textarea",modelValue:s.form.alias,"onUpdate:modelValue":a[2]||(a[2]=_=>s.form.alias=_),rows:3,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),p("div",se,[t(w,{onClick:n.handleCancel},{default:l(()=>[b("\u53D6 \u6D88")]),_:1},8,["onClick"]),t(w,{type:"primary",onClick:n.handleSubmit},{default:l(()=>[b("\u786E \u5B9A")]),_:1},8,["onClick"])])])),[[C,s.loading]])}const ne=D(le,[["render",ie]]),re={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:ne},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(o){this.$emit("update:visible",o)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function de(o,a,i,g,s,n){const u=r("DataForm"),d=r("el-dialog");return h(),S(d,{title:n.dialogTitle,modelValue:n.dialogVisible,"onUpdate:modelValue":a[0]||(a[0]=c=>n.dialogVisible=c),width:"400px",center:"","append-to-body":"","lock-scroll":!1},{default:l(()=>[n.dialogVisible?(h(),S(u,{key:0,row:i.row,onOnCancel:n.handleClose,onOnSuccess:n.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):U("",!0)]),_:1},8,["title","modelValue"])}const G=D(re,[["render",de]]);const me={name:"ExpiredDays",props:{value:{type:Number,default:null}},components:{},data(){return{}},computed:{showValue(){return Number.isInteger(this.value)},className(){return this.showValue?this.value<7?["color--danger"]:this.value<30?["color--warning"]:["color--success"]:[]}},methods:{async getData(){}},created(){this.getData()}},ce={class:"ExpireDays"},ue={key:1};function pe(o,a,i,g,s,n){return h(),v("div",ce,[n.showValue?(h(),v("span",{key:0,class:Q(n.className)},f(i.value),3)):(h(),v("span",ue,"-"))])}const A=D(me,[["render",pe]]),_e={name:"",props:{row:{type:Object,default:null}},components:{ConnectStatus:H,ExpireDays:A},data(){return{form:{domain:"",domain_url:"",ip:"",start_time:"",expire_time:"",check_time:"",connect_status:"",total_days:"",expire_days:"",create_time:"",update_time:"",detail:{issuer:{},subject:{}},real_time_expire_days:"",domain_start_time:"",domain_expire_time:"",real_time_domain_expire_days:"",alias:""},ipInfo:{isp:""}}},computed:{},methods:{async getData(){if(this.row){let o={id:this.row.id};const a=await this.$http.getDomainById(o);if(a.code!=0)return;let i=a.data;this.form.domain=i.domain,this.form.domain_url=i.domain_url,this.form.ip=i.ip,this.form.start_time=i.start_time,this.form.expire_time=i.expire_time,this.form.check_time=i.check_time,this.form.connect_status=i.connect_status,this.form.total_days=i.total_days,this.form.expire_days=i.expire_days,this.form.real_time_expire_days=i.real_time_expire_days,this.form.create_time=i.create_time,this.form.update_time=i.update_time,this.form.alias=i.alias,this.form.domain_start_time=i.domain_start_time,this.form.domain_expire_time=i.domain_expire_time,this.form.real_time_domain_expire_days=i.real_time_domain_expire_days,this.form.detail={issuer:i.detail.issuer||{},subject:i.detail.subject||{}}}},handleCancel(){this.$emit("on-cancel")},async handleUpdateRowDomainInfo(){let o=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),a={id:this.row.id};(await this.$http.updateDomainCertInfoById(a)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.getData()),o.close()},async getIpInfo(){let o={ip:this.form.ip};const a=await this.$http.getIpInfo(o);a.code==0&&(this.ipInfo=a.data)}},created(){this.getData()}},he={class:"domain-detail"},fe={class:"mo-form-detail grid grid-cols-2 mt-sm"},ge={class:"flex justify-between flex-1"},be=p("span",null," \u66F4\u65B0",-1),De={class:"mo-form-detail",style:{"margin-top":"20px"}},ye={class:"truncate"},we={class:"text-center mt-md"};function xe(o,a,i,g,s,n){const u=r("el-link"),d=r("el-form-item"),c=r("ExpireDays"),y=r("el-form"),w=r("ConnectStatus"),C=r("Refresh"),_=r("el-icon"),O=r("el-button");return h(),v("div",he,[p("div",fe,[t(y,{ref:"form",model:s.form,"label-width":"130px"},{default:l(()=>[t(d,{label:"\u57DF\u540D",prop:"domain"},{default:l(()=>[t(u,{underline:!1,href:s.form.domain_url,target:"_blank"},{default:l(()=>[b(f(s.form.domain),1)]),_:1},8,["href"])]),_:1}),t(d,{label:"ip",prop:"ip"},{default:l(()=>[p("span",null,f(s.form.ip||"-"),1)]),_:1}),t(d,{label:"\u57DF\u540D\u6CE8\u518C\u65F6\u95F4",prop:"create_time"},{default:l(()=>[p("span",null,f(s.form.domain_start_time||"-"),1)]),_:1}),t(d,{label:"\u57DF\u540D\u5230\u671F\u65F6\u95F4",prop:"create_time"},{default:l(()=>[p("span",null,f(s.form.domain_expire_time||"-"),1)]),_:1}),t(d,{label:"\u57DF\u540D\u5269\u4F59\u5929\u6570",prop:"create_time"},{default:l(()=>[t(c,{value:s.form.real_time_domain_expire_days},null,8,["value"])]),_:1}),t(d,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"create_time"},{default:l(()=>[p("span",null,f(s.form.create_time||"-"),1)]),_:1})]),_:1},8,["model"]),t(y,{ref:"form",model:s.form,"label-width":"130px"},{default:l(()=>[t(d,{label:"\u57DF\u540D\u8FDE\u63A5\u72B6\u6001",prop:"connect_status"},{default:l(()=>[t(w,{value:s.form.connect_status},null,8,["value"])]),_:1}),t(d,{label:"\u68C0\u67E5\u65F6\u95F4",prop:"check_time"},{default:l(()=>[p("div",ge,[p("span",null,f(s.form.check_time||"-"),1),t(u,{underline:!1,type:"primary",onClick:n.handleUpdateRowDomainInfo},{default:l(()=>[t(_,null,{default:l(()=>[t(C)]),_:1}),be]),_:1},8,["onClick"])])]),_:1}),t(d,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",prop:"start_time"},{default:l(()=>[p("span",null,f(s.form.start_time||"-"),1)]),_:1}),t(d,{label:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4",prop:"expire_time"},{default:l(()=>[p("span",null,f(s.form.expire_time||"-"),1)]),_:1}),t(d,{label:"\u8FC7\u671F\u5269\u4F59\u5929\u6570",prop:"real_time_expire_days"},{default:l(()=>[t(c,{value:s.form.real_time_expire_days},null,8,["value"])]),_:1}),t(d,{label:"\u66F4\u65B0\u65F6\u95F4",prop:"create_time"},{default:l(()=>[p("span",null,f(s.form.update_time||"-"),1)]),_:1})]),_:1},8,["model"])]),p("div",De,[t(y,{"label-width":"130px"},{default:l(()=>[t(d,{label:"\u5907\u6CE8",prop:"isp"},{default:l(()=>[p("span",ye,f(s.form.alias||"-"),1)]),_:1})]),_:1})]),p("div",we,[t(O,{type:"primary",onClick:n.handleCancel},{default:l(()=>[b("\u5173 \u95ED")]),_:1},8,["onClick"])])])}const Se=D(_e,[["render",xe]]),Ce={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:Se},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(o){this.$emit("update:visible",o)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose()},handleDialogClose(){this.$emit("on-success")}},created(){}};function ve(o,a,i,g,s,n){const u=r("DataForm"),d=r("el-dialog");return h(),S(d,{title:"\u57DF\u540D\u8BE6\u60C5",modelValue:n.dialogVisible,"onUpdate:modelValue":a[0]||(a[0]=c=>n.dialogVisible=c),width:"800px",center:"","append-to-body":"","lock-scroll":!1,onClose:n.handleDialogClose},{default:l(()=>[n.dialogVisible?(h(),S(u,{key:0,row:i.row,onOnCancel:n.handleClose,onOnSuccess:n.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):U("",!0)]),_:1},8,["modelValue","onClose"])}const ke=D(Ce,[["render",ve]]);const Ve={name:"ExpireProgress",props:{startTime:{type:String},endTime:{type:String},isManual:{type:Boolean}},components:{},data(){return{nowTime:F()}},computed:{parsedStartTime(){return F(this.startTime)},parsedEndTime(){return F(this.endTime)},totalDays(){return this.parsedEndTime.diff(this.parsedStartTime,"day")},expireDays(){return this.parsedEndTime.diff(this.nowTime,"day")},percentage(){let o=null;return this.expireDays&&this.totalDays&&(o=this.expireDays/this.totalDays*100),o},percentageStatus(){let o;return this.expireDays>=30?o="":this.expireDays>=3?o="warning":o="exception",o}},methods:{async getData(){}},created(){this.getData()}},Ue={class:"ExpireProgress"},Oe={class:"ExpireProgress__info"},Te={class:"el-text-color-primary"},Ie=p("span",null," / ",-1),$e={class:"el-text-color-secondary"};function Ee(o,a,i,g,s,n){const u=r("el-progress"),d=r("el-tag");return h(),v("div",Ue,[n.percentage?(h(),S(u,{key:0,percentage:n.percentage,"show-text":!1,status:n.percentageStatus},null,8,["percentage","status"])):U("",!0),p("div",Oe,[p("span",Te,f(n.expireDays||"-"),1),Ie,p("span",$e,f(n.totalDays||"-"),1),i.isManual?(h(),S(d,{key:0,type:"info",class:"mo-table-tag ml-[1px]",size:"small"},{default:l(()=>[b("\u624B\u52A8")]),_:1})):U("",!0)])])}const Re=D(Ve,[["render",Ee]]),ze={},Fe={name:"",props:{row:{type:Object,default:null}},components:{SelectGroup:B},data(){return{loading:!1,rules:ze,form:{domain_start_time:"",domain_expire_time:"",domain_auto_update:!0,start_time:"",expire_time:"",auto_update:!0}}},computed:{},methods:{async getData(){if(this.loading=!0,this.row){let o={id:this.row.id};const a=await this.$http.getDomainById(o);this.form=a.data}this.loading=!1},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(o=>{if(o)this.confirmSubmit();else return!1})},async confirmSubmit(){let o=this.$loading({fullscreen:!0}),a={domain_start_time:this.form.domain_start_time,domain_expire_time:this.form.domain_expire_time,domain_auto_update:this.form.domain_auto_update,start_time:this.form.start_time,expire_time:this.form.expire_time,auto_update:this.form.auto_update,domain_id:this.row.id},i=await this.$http.updateDomainSetting(a);i.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(i.msg),this.$nextTick(()=>{o.close()})}},created(){this.getData()}},Be=p("div",{class:"text-[12px] color--info"}," \u63D0\u793A\uFF1A\u5982\u9700\u624B\u52A8\u8BBE\u7F6E\uFF0C\u8BF7\u5173\u95ED\u81EA\u52A8\u66F4\u65B0 ",-1),Ye={class:"text-center mt-md"};function Me(o,a,i,g,s,n){const u=r("el-date-picker"),d=r("el-form-item"),c=r("el-switch"),y=r("el-form"),w=r("el-button"),C=Y("loading");return M((h(),v("div",null,[t(y,{ref:"form",model:s.form,rules:s.rules,"label-width":"100px"},{default:l(()=>[t(d,{label:"\u57DF\u540D\u6CE8\u518C\u65F6\u95F4",prop:"domain_start_time"},{default:l(()=>[t(u,{modelValue:s.form.domain_start_time,"onUpdate:modelValue":a[0]||(a[0]=_=>s.form.domain_start_time=_),type:"date","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"\u57DF\u540D\u6CE8\u518C\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u57DF\u540D\u5230\u671F\u65F6\u95F4",prop:"domain_expire_time"},{default:l(()=>[t(u,{modelValue:s.form.domain_expire_time,"onUpdate:modelValue":a[1]||(a[1]=_=>s.form.domain_expire_time=_),"value-format":"YYYY-MM-DD HH:mm:ss",type:"date",placeholder:"\u57DF\u540D\u5230\u671F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u57DF\u540D\u81EA\u52A8\u66F4\u65B0",prop:"domain_auto_update"},{default:l(()=>[t(c,{modelValue:s.form.domain_auto_update,"onUpdate:modelValue":a[2]||(a[2]=_=>s.form.domain_auto_update=_)},null,8,["modelValue"])]),_:1}),t(d,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",prop:"start_time"},{default:l(()=>[t(u,{modelValue:s.form.start_time,"onUpdate:modelValue":a[3]||(a[3]=_=>s.form.start_time=_),type:"date","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4",prop:"expire_time"},{default:l(()=>[t(u,{modelValue:s.form.expire_time,"onUpdate:modelValue":a[4]||(a[4]=_=>s.form.expire_time=_),type:"date","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u8BC1\u4E66\u81EA\u52A8\u66F4\u65B0",prop:"auto_update"},{default:l(()=>[t(c,{modelValue:s.form.auto_update,"onUpdate:modelValue":a[5]||(a[5]=_=>s.form.auto_update=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),Be,p("div",Ye,[t(w,{onClick:n.handleCancel},{default:l(()=>[b("\u53D6 \u6D88")]),_:1},8,["onClick"]),t(w,{type:"primary",onClick:n.handleSubmit},{default:l(()=>[b("\u786E \u5B9A")]),_:1},8,["onClick"])])])),[[C,s.loading]])}const Pe=D(Fe,[["render",Me]]),je={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DomainSettingForm:Pe},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(o){this.$emit("update:visible",o)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function He(o,a,i,g,s,n){const u=r("DomainSettingForm"),d=r("el-dialog");return h(),S(d,{title:"\u57DF\u540D\u8BBE\u7F6E",modelValue:n.dialogVisible,"onUpdate:modelValue":a[0]||(a[0]=c=>n.dialogVisible=c),width:"380px",center:"","append-to-body":"","lock-scroll":!1},{default:l(()=>[n.dialogVisible?(h(),S(u,{key:0,row:i.row,onOnCancel:n.handleClose,onOnSuccess:n.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):U("",!0)]),_:1},8,["modelValue"])}const Ge=D(je,[["render",He]]),Ae={name:"",components:{DataFormDialog:G,DataDetailDialog:ke,ConnectStatus:H,ExpireDays:A,ExpireProgress:Re,DomainSettingDialog:Ge},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1,dialogDetailVisible:!1,DomainSettingDialogVisible:!1}},methods:{handleEditRow(o){this.currentRow=o,this.dialogVisible=!0},async handleDeleteClick(o){let a={id:o.id};const i=await this.$http.deleteDomainById(a);i.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(i.msg)},async handleStatusChange(o){let a={id:o.id};const i=await this.$Http.function(a);i.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(i.msg)},async handleMonitorStatusChange(o,a){let i={id:o.id,is_monitor:a};const g=await this.$http.updateDomainById(i);g.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(g.msg)},async handleUpdateRowDomainInfo(o){let a=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),i={id:o.id};(await this.$http.updateDomainCertInfoById(i)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")),a.close()},handleUpdateSuccess(){this.$emit("on-success")},handleDetailSuccess(){},handleShowDetail(o){this.currentRow=o,this.dialogDetailVisible=!0},handleDomainSettingDialogShow(o){this.currentRow=o,this.DomainSettingDialogVisible=!0}},created(){}};function Ne(o,a,i,g,s,n){const u=r("el-link"),d=r("el-tooltip"),c=r("el-table-column"),y=r("ExpireDays"),w=r("el-tag"),C=r("ExpireProgress"),_=r("ConnectStatus"),O=r("el-switch"),T=r("Tickets"),V=r("el-icon"),I=r("Refresh"),$=r("Setting"),E=r("Edit"),R=r("Delete"),z=r("el-popconfirm"),x=r("el-table"),N=r("DataFormDialog"),q=r("DataDetailDialog"),K=r("DomainSettingDialog");return h(),v("div",null,[t(x,W({data:i.list,stripe:"",border:""},o.$attrs,X(o.$events)),{default:l(()=>[t(c,{label:"\u57DF\u540D","header-align":"center",align:"center",width:"180","show-overflow-tooltip":"",prop:"domain"},{default:l(m=>[t(d,{disabled:!m.row.alias,content:m.row.alias},{default:l(()=>[t(u,{underline:!1,href:m.row.domain_url,target:"_blank"},{default:l(()=>[b(f(m.row.domain),1)]),_:2},1032,["href"])]),_:2},1032,["disabled","content"])]),_:1}),t(c,{label:"\u57DF\u540D\u5929\u6570","header-align":"center",align:"center",width:"110",sortable:"custom",prop:"domain_expire_days"},{default:l(m=>[t(y,{value:m.row.real_time_domain_expire_days},null,8,["value"]),m.row.domain_auto_update?U("",!0):(h(),S(w,{key:0,class:"ml-[5px] mo-table-tag",type:"info",size:"small"},{default:l(()=>[b("\u624B\u52A8")]),_:1}))]),_:1}),t(c,{label:"\u8BC1\u4E66\u5929\u6570","header-align":"center",align:"center",width:"120",sortable:"custom",prop:"expire_days"},{default:l(m=>[t(C,{startTime:m.row.start_time,endTime:m.row.expire_time,isManual:!m.row.auto_update},null,8,["startTime","endTime","isManual"])]),_:1}),t(c,{label:"\u72B6\u6001","header-align":"center",align:"center",width:"60",prop:"connect_status"},{default:l(m=>[t(_,{value:m.row.connect_status},null,8,["value"])]),_:1}),t(c,{label:"\u5206\u7EC4","header-align":"center",align:"center",width:"100",prop:"check_time"},{default:l(m=>[p("span",null,f(m.row.group_name||"-"),1)]),_:1}),t(c,{label:"\u5907\u6CE8","header-align":"center",align:"center",prop:"check_time","show-overflow-tooltip":""},{default:l(m=>[p("span",null,f(m.row.alias||"-"),1)]),_:1}),t(c,{label:"\u66F4\u65B0\u65F6\u95F4","header-align":"center",align:"center",width:"100",prop:"check_time","show-overflow-tooltip":""},{default:l(m=>[p("span",null,f(m.row.update_time_label||"-"),1)]),_:1}),t(c,{label:"\u76D1\u6D4B",width:"66","header-align":"center",align:"center"},{default:l(m=>[t(O,{style:{transform:"scale(0.8)"},modelValue:m.row.is_monitor,"onUpdate:modelValue":k=>m.row.is_monitor=k,size:"mini",onChange:k=>n.handleMonitorStatusChange(m.row,k)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(c,{label:"\u64CD\u4F5C",width:"140","header-align":"center",align:"center"},{default:l(m=>[t(u,{underline:!1,type:"primary",class:"mr-sm",onClick:k=>n.handleShowDetail(m.row)},{default:l(()=>[t(V,null,{default:l(()=>[t(T)]),_:1})]),_:2},1032,["onClick"]),t(u,{underline:!1,type:"primary",class:"mr-sm",onClick:k=>n.handleUpdateRowDomainInfo(m.row)},{default:l(()=>[t(V,null,{default:l(()=>[t(I)]),_:1})]),_:2},1032,["onClick"]),t(u,{underline:!1,type:"primary",class:"mr-sm",onClick:k=>n.handleDomainSettingDialogShow(m.row)},{default:l(()=>[t(V,null,{default:l(()=>[t($)]),_:1})]),_:2},1032,["onClick"]),t(u,{underline:!1,type:"primary",class:"mr-sm",onClick:k=>n.handleEditRow(m.row)},{default:l(()=>[t(V,null,{default:l(()=>[t(E)]),_:1})]),_:2},1032,["onClick"]),t(z,{title:"\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:k=>n.handleDeleteClick(m.row)},{reference:l(()=>[t(u,{underline:!1,type:"danger"},{default:l(()=>[t(V,null,{default:l(()=>[t(R)]),_:1})]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},16,["data"]),t(N,{visible:s.dialogVisible,"onUpdate:visible":a[0]||(a[0]=m=>s.dialogVisible=m),row:s.currentRow,onOnSuccess:n.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"]),t(q,{row:s.currentRow,visible:s.dialogDetailVisible,"onUpdate:visible":a[1]||(a[1]=m=>s.dialogDetailVisible=m),onOnSuccess:n.handleDetailSuccess},null,8,["row","visible","onOnSuccess"]),t(K,{row:s.currentRow,visible:s.DomainSettingDialogVisible,"onUpdate:visible":a[2]||(a[2]=m=>s.DomainSettingDialogVisible=m),onOnSuccess:n.handleUpdateSuccess},null,8,["row","visible","onOnSuccess"])])}const qe=D(Ae,[["render",Ne]]),Ke={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u66F4\u65B0":"\u5168\u90E8\u66F4\u65B0"}},methods:{async updateAllDomainCertInfoOfUser(){this.updateTimer=setInterval(()=>{this.getUpdateDomainStatusOfUser()},2e3),(await this.$http.updateAllDomainCertInfoOfUser()).code==0&&this.$msg.success("\u64CD\u4F5C\u6210\u529F")},async getUpdateDomainStatusOfUser(){const o=await this.$http.getUpdateDomainStatusOfUser();o.ok&&o.data.status==!1&&(clearInterval(this.updateTimer),this.updateTimer=null,this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success"))}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function Le(o,a,i,g,s,n){const u=r("Refresh"),d=r("el-icon"),c=r("el-button");return h(),S(c,{onClick:n.updateAllDomainCertInfoOfUser,disabled:n.disableUpdateButton},{default:l(()=>[t(d,null,{default:l(()=>[t(u)]),_:1}),b(f(n.updateText),1)]),_:1},8,["onClick","disabled"])}const Qe=D(Ke,[["render",Le]]),We={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u68C0\u67E5":"\u8BC1\u4E66\u68C0\u67E5"}},methods:{async checkDomainCert(){this.updateTimer=setInterval(()=>{this.getUpdateDomainStatusOfUser()},2e3),(await this.$http.checkDomainCert()).ok&&this.$msg.success("\u64CD\u4F5C\u6210\u529F")},async getUpdateDomainStatusOfUser(){const o=await this.$http.getCheckDomainStatusOfUser();o.ok&&o.data.status==!1&&(clearInterval(this.updateTimer),this.updateTimer=null,this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success"))}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function Xe(o,a,i,g,s,n){const u=r("Position"),d=r("el-icon"),c=r("el-button");return h(),S(c,{class:"margin-left--auto",onClick:n.checkDomainCert,disabled:n.disableUpdateButton},{default:l(()=>[t(d,null,{default:l(()=>[t(u)]),_:1}),b(f(n.updateText),1)]),_:1},8,["onClick","disabled"])}const Ze=D(We,[["render",Xe]]),Je={name:"domain-list",props:{},components:{DataFormDialog:G,DataTable:qe,SelectGroup:B,UpdateDomainInfo:Qe,CheckDomainInfo:Ze},data(){return{dataApi:j,list:[],total:0,page:1,size:20,keyword:"",group_id:"",pageSizeCachekey:"pageSize",loading:!0,dialogVisible:!1,export_to_file_url:L(j.exportDomainToFile),order_type:"ascending",order_prop:"expire_days"}},computed:{...Z(P,{groupOptions:"getGroupOptions"})},methods:{...J(P,{updateGroupOptions:"updateGroupOptions"}),resetData(){this.page=1,this.getData()},refreshData(){this.getData()},async getData(){this.loading=!0;let o={page:this.page,size:this.size,group_id:this.group_id,keyword:this.keyword.trim(),order_type:this.order_type,order_prop:this.order_prop};const a=await this.$http.getDomainList(o);a.code==0?(this.list=a.data.list.map(i=>(i.group_id&&(i.group_name=this.getGroupName(i.group_id)),i)),this.total=a.data.total):this.$msg.error(e.msg),this.loading=!1},getGroupName(o){let a=this.groupOptions.find(i=>i.value==o);if(a)return a.name},async handleHttpRequest(o){let a=this.$loading({fullscreen:!0}),i=new FormData;i.append("file",o.file),(await this.$http.importDomainFromFile(i)).code==0&&(this.$msg.success("\u4E0A\u4F20\u6210\u529F\uFF0C\u540E\u53F0\u5BFC\u5165\u4E2D"),this.resetData()),a.close()},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},async handleExportToFile(){const o=await this.$http.exportDomainFile();o.ok&&ae.saveAs(o.data.url,"domain.txt")},handleSearch(){this.resetData()},handleSizeChange(o){localStorage.setItem(this.pageSizeCachekey,o),this.resetData()},loadPageSize(){let o=localStorage.getItem(this.pageSizeCachekey);o&&(this.size=parseInt(o))},handleExceed(o){this.$refs.upload.clearFiles();const a=o[0];a.uid=te(),this.handleHttpRequest({file:a})},handleSortChange({column:o,prop:a,order:i}){console.log(o,a,i),this.order_type=i,this.order_prop=a,this.resetData()},async initData(){this.loadPageSize(),await this.updateGroupOptions(),this.getData()}},created(){this.initData()}},et={class:"app-container"},tt={class:"flex justify-between"},at={class:"flex"};function ot(o,a,i,g,s,n){const u=r("Plus"),d=r("el-icon"),c=r("el-button"),y=r("SelectGroup"),w=r("Search"),C=r("el-input"),_=r("UpdateDomainInfo"),O=r("CheckDomainInfo"),T=r("Upload"),V=r("el-upload"),I=r("Download"),$=r("DataTable"),E=r("el-pagination"),R=r("DataFormDialog"),z=Y("loading");return h(),v("div",et,[p("div",tt,[p("div",null,[t(c,{type:"primary",onClick:n.handleAddRow},{default:l(()=>[t(d,null,{default:l(()=>[t(u)]),_:1}),b("\u6DFB\u52A0")]),_:1},8,["onClick"]),t(y,{class:"w-[150px] ml-sm",modelValue:s.group_id,"onUpdate:modelValue":a[0]||(a[0]=x=>s.group_id=x),clearable:"",onChange:n.resetData},null,8,["modelValue","onChange"]),t(C,{class:"ml-sm",style:{width:"260px"},modelValue:s.keyword,"onUpdate:modelValue":a[1]||(a[1]=x=>s.keyword=x),placeholder:"\u641C\u7D22\u57DF\u540D",clearable:"",onKeypress:ee(n.handleSearch,["enter"]),onClear:n.handleSearch},{append:l(()=>[t(c,{onClick:n.handleSearch},{default:l(()=>[t(d,null,{default:l(()=>[t(w)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),p("div",at,[t(_,{onOnSuccess:n.resetData},null,8,["onOnSuccess"]),t(O,{onOnSuccess:n.resetData},null,8,["onOnSuccess"]),t(V,{class:"ml-sm",ref:"upload",action:"action",accept:".txt",limit:1,"on-exceed":n.handleExceed,"show-file-list":!1,"http-request":n.handleHttpRequest},{default:l(()=>[t(c,null,{default:l(()=>[t(d,null,{default:l(()=>[t(T)]),_:1}),b("\u5BFC\u5165")]),_:1})]),_:1},8,["on-exceed","http-request"]),t(c,{class:"ml-sm",onClick:n.handleExportToFile},{default:l(()=>[t(d,null,{default:l(()=>[t(I)]),_:1}),b("\u5BFC\u51FA")]),_:1},8,["onClick"])])]),M(t($,{class:"mt-md",list:s.list,onOnSuccess:n.resetData,onSortChange:n.handleSortChange},null,8,["list","onOnSuccess","onSortChange"]),[[z,s.loading]]),t(E,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:s.total,"page-size":s.size,"onUpdate:page-size":a[2]||(a[2]=x=>s.size=x),"current-page":s.page,"onUpdate:current-page":a[3]||(a[3]=x=>s.page=x),onCurrentChange:n.getData,onSizeChange:n.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"]),t(R,{visible:s.dialogVisible,"onUpdate:visible":a[4]||(a[4]=x=>s.dialogVisible=x),onOnSuccess:n.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const ct=D(Je,[["render",ot]]);export{ct as default};
