// 使用这个配置需要 caddy 或者 ngnix 的配合，他们接收来自用户的请求，然后解密tls，
// 最后转发到v2ray（即此处）

{
  "log": {
    "loglevel": "none" // 真实环境中不应该有log，不然会挤爆硬盘。
  },
  "inbounds": [{
    "port": 10000,
    "tag": "uif_inbound", // not free
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "vmess",
    "settings": {
      "clients": [{
        "id": "a831381d-6324-4d53-ad4f-9cda48b30648",
        "alterId": 0
      }] // 可由用户自由添加
    },
    "streamSettings": {
      "network": "ws",
      "wsSettings": {
        "path": "/uif"
      }
    }
  }, {
    "port": 10002,
    "tag": "uif_inbound_ipv6", // not free
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "vmess",
    "settings": {
      "clients": [{
        "id": "a831381d-6324-4d53-ad4f-9cda48b30648",
        "alterId": 0
      }] // 可由用户自由添加
    },
    "streamSettings": {
      "network": "ws",
      "wsSettings": {
        "path": "/uif_ipv6"
      }
    }
  }, {
    "port": 10005,
    "tag": "uif_inbound_rpc",
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "trojan",
    "settings": {
      "clients": [{
        "password": "password2"
      }]
    },
    "streamSettings": {
      "network": "grpc",
      "grpcSettings": {
        "serviceName": "grpc"
      }
    }
  }, {
    "port": 10003,
    "tag": "uif_inbound_http",
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "http",
    "settings": {
      "accounts": [{
        "user": "my-username1",
        "pass": "123w"
      }],
      "allowTransparent": false
    },
    "streamSettings": {
      "network": "ws",
      "wsSettings": {
        "path": "/uif_http"
      }
    }
  }, {
    "port": 10001,
    "tag": "uif_inbound_free",
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "vmess",
    "settings": {
      "clients": [{
        "id": "b831381d-6324-4d53-ad4f-9cda48b30822", // 建议经常变，以防有些人长久霸占
        "alterId": 0
      }]
    },
    "streamSettings": {
      "network": "ws",
      "wsSettings": {
        "path": "/uif_free"
      }
    }
  }, {
    "port": 10004,
    "tag": "uif_inbound_trojan",
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "trojan",
    "settings": {
      "clients": [{
        "password": "password2",
        "email": "love@xray.com"
      }]
    },
    "streamSettings": {
      "network": "ws",
      "wsSettings": {
        "path": "/uif_trojan"
      }
    }
  }, {
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "port": 10085,
    "protocol": "dokodemo-door",
    "settings": {
      "address": "127.0.0.1"
    },
    "tag": "api"
  }],
  "api": {
    "tag": "api",
    "services": [
      "HandlerService",
      "StatsService"
    ]
  },
  "policy": {
    "levels": {
      "0": {
        "statsUserUplink": true, //开启用户流量上传统计
        "statsUserDownlink": true //开启用户流量下载统计
      }
    },
    "system": {
      "statsInboundUplink": true, //开启入站方向的流量上传
      "statsInboundDownlink": true, //开启入站方向的流量下载
      "statsOutboundUplink": true, //开启出站方向的流量上传
      "statsOutboundDownlink": true //开启出站方向的流量下载
    }
  },
  "outbounds": [{
    "tag": "IP4_out",
    "protocol": "freedom"
  }, {
    "tag": "IP6_out",
    "protocol": "freedom",
    "settings": {
      "domainStrategy": "UseIPv6" // 指定使用 IPv6
    }
  }, {
    "tag": "block",
    "protocol": "blackhole",
    "settings": {
      "response": {
        "type": "http"
      }
    }
  }],
  "routing": {
    "rules": [{
        "inboundTag": [ // 免费用户禁止种子流量
          "uif_inbound_free"
        ],
        "type": "field",
        "protocol": [
          "bittorrent"
        ],
        "outboundTag": "block"
      }, {
        "inboundTag": [
          "uif_inbound_ipv6"
        ],
        "type": "field",
        "outboundTag": "IP6_out",
        "network": "udp,tcp",
        "domain": ["geosite:google"] // 走 IPv6
      },
      {
        "inboundTag": [ // 总出口
          "uif_inbound",
          "uif_inbound_ipv6",
          "uif_inbound_http",
          "uif_inbound_rpc",
          "uif_inbound_trojan",
          "uif_inbound_free"
        ],
        "type": "field",
        "outboundTag": "IP4_out",
        "network": "udp,tcp"
      }, {
        "inboundTag": [
          "api"
        ],
        "outboundTag": "api",
        "type": "field"
      }
    ]
  }
}
