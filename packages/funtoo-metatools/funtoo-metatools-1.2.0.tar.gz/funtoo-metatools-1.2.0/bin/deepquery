#!/usr/bin/python3
#
# This command will show all packages in a category (such as 'dev-perl', which is specified
# as the command-line argument) upon which no other packages depend.

# The output of this command can be used to remove things from packages.yaml as follows:
#
# for x in $(deepquery dev-haskell); do echo Removing $x; sed -i -e "\|- ${x}\$|d" packages.yaml ; done
#
# For an independent kit, you can use the following:
#
# for x in $(deepquery dev-perl | cut -f1 -d' '); do git rm -rf $x; done

import sys
from subpop.hub import Hub

hub = Hub()

import dyne.org.funtoo.metatools.merge as merge

if __name__ == "__main__":
	nodep_catpkgs = dict()
	for pypak in merge.model.DEEPDIVE.find({"category": sys.argv[1]}):
		dep_on_me = merge.model.DEEPDIVE.count_documents({"relations": {"$in": [pypak["catpkg"]]}})
		if dep_on_me == 0:
			nodep_catpkgs[pypak["catpkg"]] = pypak["kit"]

	for item in sorted(list(nodep_catpkgs.keys())):
		print(item, nodep_catpkgs[item])
