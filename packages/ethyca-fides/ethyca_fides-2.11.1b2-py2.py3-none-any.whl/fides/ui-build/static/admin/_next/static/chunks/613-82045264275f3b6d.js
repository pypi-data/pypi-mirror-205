"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{73465:function(e,t,n){n.d(t,{OK:function(){return C},mQ:function(){return P},nP:function(){return z},td:function(){return A},x4:function(){return T}});var a=n(81439),r=n(15031),i=n(67294),s=n(87096),o=n(40242),c=n(97375),l=n(44697),u=n(26450);function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}function p(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}var f=["defaultIndex","onChange","index","isManual","isLazy","lazyBehavior","orientation","direction"],m=["isDisabled","isFocusable"],y=["isSelected","id","children"],h=(0,o.n)(),b=h[0],v=h[1],x=h[2],g=h[3];var j=(0,u.kr)({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"}),_=j[0],w=j[1];function O(e,t){return e+"--tab-"+t}function D(e,t){return e+"--tabpanel-"+t}var S=["children","className"],k=["htmlProps","descendants"],P=(0,a.Gp)((function(e,t){var n=(0,a.jC)("Tabs",e),s=(0,a.Lr)(e),o=s.children,l=s.className,u=function(e){var t=e.defaultIndex,n=e.onChange,a=e.index,r=e.isManual,s=e.isLazy,o=e.lazyBehavior,l=void 0===o?"unmount":o,u=e.orientation,d=void 0===u?"horizontal":u,m=e.direction,y=void 0===m?"ltr":m,h=p(e,f),b=i.useState(null!=t?t:0),v=b[0],g=b[1],j=(0,c.Tx)({defaultValue:null!=t?t:0,value:a,onChange:n}),_=j[0],w=j[1];i.useEffect((function(){null!=a&&g(a)}),[a]);var O=x();return{id:(0,c.Me)(e.id,"tabs"),selectedIndex:_,focusedIndex:v,setSelectedIndex:w,setFocusedIndex:g,isManual:r,isLazy:s,lazyBehavior:l,orientation:d,descendants:O,direction:y,htmlProps:h}}(p(s,S)),m=u.htmlProps,y=u.descendants,h=p(u,k),v=i.useMemo((function(){return h}),[h]),g=(0,r.CE)(m,["isFitted"]);return i.createElement(b,{value:y},i.createElement(_,{value:v},i.createElement(a.Fo,{value:n},i.createElement(a.m$.div,d({className:(0,r.cx)("chakra-tabs",l),ref:t},g,{__css:n.root}),o))))}));r.Ts&&(P.displayName="Tabs");var C=(0,a.Gp)((function(e,t){var n=(0,a.yK)(),o=function(e){var t=e.isDisabled,n=e.isFocusable,a=p(e,m),i=w(),o=i.setSelectedIndex,c=i.isManual,l=i.id,f=i.setFocusedIndex,y=i.selectedIndex,h=g({disabled:t&&!n}),b=h.index,v=h.register,x=b===y,j=(0,s.h)(d({},a,{ref:(0,u.lq)(v,e.ref),isDisabled:t,isFocusable:n,onClick:(0,r.v0)(e.onClick,(function(){o(b)}))}));return d({},j,{id:O(l,b),role:"tab",tabIndex:x?0:-1,type:"button","aria-selected":x,"aria-controls":D(l,b),onFocus:t?void 0:(0,r.v0)(e.onFocus,(function(){f(b),!c&&(!t||!n)&&o(b)}))})}(d({},e,{ref:t})),c=d({outline:"0",display:"flex",alignItems:"center",justifyContent:"center"},n.tab);return i.createElement(a.m$.button,d({},o,{className:(0,r.cx)("chakra-tabs__tab",e.className),__css:c}))}));r.Ts&&(C.displayName="Tab");var A=(0,a.Gp)((function(e,t){var n=function(e){var t=w(),n=t.focusedIndex,a=t.orientation,s=t.direction,o=v(),c=i.useCallback((function(e){var t,i=function(){var e=o.nextEnabled(n);e&&(0,r.T_)(e.node)},c=function(){var e=o.prevEnabled(n);e&&(0,r.T_)(e.node)},l="horizontal"===a,u="vertical"===a,d=(0,r.uh)(e),p="ltr"===s?"ArrowRight":"ArrowLeft",f=((t={})["ltr"===s?"ArrowLeft":"ArrowRight"]=function(){return l&&c()},t[p]=function(){return l&&i()},t.ArrowDown=function(){return u&&i()},t.ArrowUp=function(){return u&&c()},t.Home=function(){var e=o.firstEnabled();e&&(0,r.T_)(e.node)},t.End=function(){var e=o.lastEnabled();e&&(0,r.T_)(e.node)},t)[d];f&&(e.preventDefault(),f(e))}),[o,n,a,s]);return d({},e,{role:"tablist","aria-orientation":a,onKeyDown:(0,r.v0)(e.onKeyDown,c)})}(d({},e,{ref:t})),s=d({display:"flex"},(0,a.yK)().tablist);return i.createElement(a.m$.div,d({},n,{className:(0,r.cx)("chakra-tabs__tablist",e.className),__css:s}))}));r.Ts&&(A.displayName="TabList");var T=(0,a.Gp)((function(e,t){var n=function(e){var t=e.isSelected,n=e.id,a=e.children,s=p(e,y),o=w(),c=o.isLazy,l=o.lazyBehavior,u=i.useRef(!1);return t&&(u.current=!0),d({tabIndex:0},s,{children:(0,r.VI)({hasBeenSelected:u.current,isSelected:t,isLazy:c,lazyBehavior:l})?a:null,role:"tabpanel",hidden:!t,id:n})}(d({},e,{ref:t})),s=(0,a.yK)();return i.createElement(a.m$.div,d({outline:"0"},n,{className:(0,r.cx)("chakra-tabs__tab-panel",e.className),__css:s.tabpanel}))}));r.Ts&&(T.displayName="TabPanel");var z=(0,a.Gp)((function(e,t){var n=function(e){var t=w(),n=t.id,a=t.selectedIndex;return d({},e,{children:(0,u.WR)(e.children).map((function(e,t){return i.cloneElement(e,{isSelected:t===a,id:D(n,t),"aria-labelledby":O(n,t)})}))})}(e),s=(0,a.yK)();return i.createElement(a.m$.div,d({},n,{width:"100%",ref:t,className:(0,r.cx)("chakra-tabs__tab-panels",e.className),__css:s.tabpanels}))}));r.Ts&&(z.displayName="TabPanels");var E=(0,a.Gp)((function(e,t){var n=function(){var e=w(),t=v(),n=e.selectedIndex,a=e.orientation,s="horizontal"===a,o="vertical"===a,c=i.useState((function(){return s?{left:0,width:0}:o?{top:0,height:0}:void 0})),u=c[0],p=c[1],f=i.useState(!1),m=f[0],y=f[1];return(0,l.a)((function(){if(!(0,r.o8)(n)){var e=t.item(n);if(!(0,r.o8)(e)){s&&p({left:e.node.offsetLeft,width:e.node.offsetWidth}),o&&p({top:e.node.offsetTop,height:e.node.offsetHeight});var a=requestAnimationFrame((function(){y(!0)}));return function(){a&&cancelAnimationFrame(a)}}}}),[n,s,o,t]),d({position:"absolute",transitionProperty:"left, right, top, bottom, height, width",transitionDuration:m?"200ms":"0ms",transitionTimingFunction:"cubic-bezier(0, 0, 0.2, 1)"},u)}(),s=d({},e.style,n),o=(0,a.yK)();return i.createElement(a.m$.div,d({ref:t},e,{className:(0,r.cx)("chakra-tabs__tab-indicator",e.className),style:s,__css:o.indicator}))}));r.Ts&&(E.displayName="TabIndicator")},99429:function(e,t,n){n.d(t,{Y:function(){return s}});var a=n(18975),r=n(41086);a.registerLocale(r);var i=a.getNames("en",{select:"official"}),s=Object.keys(i).map((function(e){return{value:a.alpha2ToAlpha3(e),label:i[e]}}))},99039:function(e,t,n){n.d(t,{V:function(){return i}});var a=n(53700),r=n(45035),i=function(){return{systemOrDatamapRoute:(0,a.hz)().plus?r.oG:r.So}}},64940:function(e,t,n){n.d(t,{Z:function(){return Ae}});var a=n(59499),r=n(68527),i=n(15193),s=n(28609),o=n(52206),c=n(41664),l=n.n(c),u=n(11163),d=n(67294),p=n(97142),f=n(52313),m=n(99039),y=n(10846),h=n(50029),b=n(4730),v=n(16835),x=n(87794),g=n.n(x),j=n(49609),_=n(65698),w=n(67087),O=n(29482),D=n(44116),S=n(71206),k=n(24256),P=n(27812),C=n(47398),A=n(94090),T=n(82175),z=n(97375),E=n(48591),Z=n(74231),q=n(58144),M=n(96016),V=n(85893),F=["onSubmit","initialValues","onDelete"];function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=Z.Ry().shape({data_categories:Z.IX(Z.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:Z.Z_().required().label("Data use"),data_subjects:Z.IX(Z.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),K={data_categories:[],data_subjects:[],data_use:"",dataset_references:[]},R=function(e){return L(L({},e),{},{id:e.name?"".concat(e.data_use," - ").concat(e.name):e.data_use})},B=function(e){return e.map(R)},U=function(e){var t=e.allDataUses,n=e.allDataCategories,a=e.allDataSubjects,s=e.allDatasets,o=e.onDelete,c=(0,T.u6)(),l=c.dirty,u=c.isSubmitting,d=c.isValid,p=c.initialValues,f=(0,z.qY)(),m=s?s.map((function(e){var t;return{label:null!==(t=e.name)&&void 0!==t?t:e.fides_key,value:e.fides_key}})):[],y=function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(R(p));case 2:f.onClose();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=""===p.data_use;return(0,V.jsxs)(r.Kq,{spacing:4,children:[(0,V.jsx)(M.AP,{id:"data_use",label:"Data use",name:"data_use",options:t.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",variant:"stacked",singleValueBlock:!0}),(0,V.jsx)(M.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use."}),(0,V.jsx)(M.AP,{name:"data_categories",label:"Data categories",options:n.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",isMulti:!0,variant:"stacked"}),(0,V.jsx)(M.AP,{name:"data_subjects",label:"Data subjects",options:a.map((function(e){return{value:e.fides_key,label:e.fides_key}})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",isMulti:!0,variant:"stacked"}),s?(0,V.jsx)(M.AP,{name:"dataset_references",label:"Dataset references",options:m,tooltip:"Referenced Dataset fides keys used by the system.",isMulti:!0,variant:"stacked"}):null,(0,V.jsxs)(i.hE,{size:"sm",display:"flex",justifyContent:"space-between",children:[(0,V.jsx)(i.zx,{variant:"outline",onClick:f.onOpen,disabled:b,"data-testid":"delete-btn",children:"Delete"}),(0,V.jsx)(i.zx,{type:"submit",colorScheme:"primary",disabled:!l||!d,isLoading:u,"data-testid":"save-btn",children:"Save"})]}),(0,V.jsx)(q.Z,{onConfirm:y,title:"Delete data use",message:"Are you sure you want to delete this data use? This action can't be undone.",isOpen:f.isOpen,onClose:f.onClose,isCentered:!0})]})},W=function(e){var t=e.onSubmit,n=e.initialValues,a=e.allDataUses,i=null!==n&&void 0!==n?n:K,s=(0,d.useState)(!1),o=s[0],c=s[1],l=(0,d.useMemo)((function(){var e=a.filter((function(e){return e.fides_key===i.data_use}))[0];if(e)return i.name?"".concat(e.name," - ").concat(i.name):e.name}),[a,i]),u=function(){var e=(0,h.Z)(g().mark((function e(n,a){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(R(n),a);case 2:e.sent&&(a.resetForm({values:n}),c(!0));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return{handleSubmit:u,renderHeader:function(e){var t=e.dirty,n=e.boxProps,a=e.hideSaved;return(0,V.jsxs)(r.xu,L(L({display:"flex",alignItems:"center"},n),{},{children:[l?(0,V.jsx)(r.X6,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:l}):null,!a&&o&&!t&&i.data_use?(0,V.jsxs)(r.xv,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,V.jsx)(E.St,{})," Saved"]}):null]}))},initialValues:i}},H=function(e){var t=e.onSubmit,n=e.initialValues,a=e.onDelete,i=(0,b.Z)(e,F),s=W({onSubmit:t,initialValues:n,allDataUses:i.allDataUses}),o=s.handleSubmit,c=s.renderHeader,l=s.initialValues;return(0,V.jsx)(T.J9,{enableReinitialize:!0,initialValues:l,onSubmit:o,validationSchema:N,children:function(e){var t=e.dirty;return(0,V.jsx)(T.l0,{children:(0,V.jsxs)(r.Kq,{spacing:4,children:[(0,V.jsx)(r.xu,{"data-testid":"header",children:c({dirty:t})}),(0,V.jsx)(U,L({onDelete:a},i))]})})}})},Y=["privacyDeclaration","onEdit","onDelete"],G=["privacyDeclarations"];function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J=function(e){var t=e.privacyDeclaration,n=e.onEdit,a=e.onDelete,i=(0,b.Z)(e,Y),s=W($({initialValues:t,onSubmit:function(e){return n(t,e)}},i)),o=s.initialValues,c=s.renderHeader,l=s.handleSubmit;return(0,V.jsx)(A.Qd,{children:function(e){var n=e.isExpanded;return(0,V.jsx)(T.J9,{enableReinitialize:!0,initialValues:o,onSubmit:l,validationSchema:N,children:function(e){var s=e.dirty;return(0,V.jsxs)(T.l0,{"data-testid":"".concat(t.data_use,"-form"),children:[(0,V.jsxs)(A.KF,{py:4,borderBottomWidth:n?"0px":"1px",backgroundColor:n?"gray.50":void 0,"data-testid":"accordion-header-".concat(t.data_use),children:[c({dirty:s,boxProps:{flex:"1",textAlign:"left"},hideSaved:!n}),(0,V.jsx)(A.XE,{})]}),(0,V.jsx)(A.Hk,{backgroundColor:"gray.50",pt:0,children:(0,V.jsx)(r.Kq,{spacing:4,children:(0,V.jsx)(U,$({onDelete:a},i))})})]})}})}})},Q=function(e){var t=e.privacyDeclarations,n=(0,b.Z)(e,G);return(0,V.jsx)(A.UQ,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:t.map((function(e){return(0,V.jsx)(J,$({privacyDeclaration:e},n),e.id)}))})},ee=["id"],te=["system","onCollision","onSave"];function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var re=function(e){e.id;var t,n=(0,b.Z)(e,ee);return ae(ae({},n),{},{name:null!==(t=n.name)&&void 0!==t?t:""})},ie=function(e){var t=e.system,n=e.onCollision,a=e.onSave,o=(0,b.Z)(e,te),c=(0,s.pm)(),l=(0,d.useState)(!1),u=l[0],p=l[1],f=(0,d.useState)(void 0),m=f[0],y=f[1],v=(0,d.useMemo)((function(){var e=B(t.privacy_declarations);return m?e.filter((function(e){return e.id!==m.id})):e}),[m,t]),x=function(e){return v.filter((function(t){return t.data_use===e.data_use&&t.name===e.name})).length>0&&(n(),!0)},j=function(){var e=(0,h.Z)(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map((function(e){return re(e)})),e.next=3,a(r,n);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=(0,h.Z)(g().mark((function e(t,n){var a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.id===t.id||!x(n)){e.next=2;break}return e.abrupt("return",!1);case 2:return a=v.map((function(e){return e.id===t.id?n:e})),e.abrupt("return",j(a));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!x(t)){e.next=2;break}return e.abrupt("return",!1);case 2:return c.closeAll(),y(t),n=[].concat((0,P.Z)(v),[t]),e.abrupt("return",j(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=(0,h.Z)(g().mark((function e(n){var a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=B(t.privacy_declarations).filter((function(e){return e.id!==n.id})),e.abrupt("return",j(a,!0));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:return(n=e.sent)&&(p(!1),y(void 0)),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=t.privacy_declarations.length>0||0===t.privacy_declarations.length&&!u;return(0,V.jsxs)(r.Kq,{spacing:3,children:[(0,V.jsx)(Q,ae({privacyDeclarations:v,onEdit:_,onDelete:O},o)),u?(0,V.jsx)(r.xu,{backgroundColor:"gray.50",p:6,"data-testid":"new-declaration-form",children:(0,V.jsx)(H,ae({initialValues:m,onSubmit:w,onDelete:D},o))}):null,S?(0,V.jsx)(r.xu,{py:2,children:(0,V.jsx)(C.u,{label:"Add another use case",hasArrow:!0,placement:"top",isDisabled:0===v.length,children:(0,V.jsx)(i.zx,{colorScheme:"primary",size:"xs","data-testid":"add-btn",onClick:function(){p(!0),y(void 0)},disabled:u&&!m,children:"Add a Data Use +"})})}):null]})},se=["isLoading"];function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le=function(e){var t=e.system,n=(0,s.pm)(),a=(0,p.T)(),i=(0,w.qQ)(),o=(0,v.Z)(i,1)[0],c=function(){var e=(0,k.MO)().isLoading,t=(0,O.te)().isLoading,n=(0,D.fd)().isLoading,a=(0,S.NR)().isLoading;return{allDataCategories:(0,p.C)(k.qb),allDataSubjects:(0,p.C)(O.ZL),allDataUses:(0,p.C)(D.U3),allDatasets:(0,p.C)(S.nx),isLoading:e||t||n||a}}(),u=c.isLoading,d=(0,b.Z)(c,se),f=function(){var e=(0,h.Z)(g().mark((function e(r,i){var s,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=ce(ce({},t),{},{privacy_declarations:r}),c=function(e){if((0,_.D4)(e)){var t=(0,_.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");return n((0,y.Vo)(t)),!1}return n.closeAll(),n((0,y.t5)(i?"Data use deleted":"Data use saved")),a((0,w.db)(e.data)),!0},e.next=4,o(s);case 4:return l=e.sent,e.abrupt("return",c(l));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return(0,V.jsxs)(r.Kq,{spacing:3,"data-testid":"privacy-declaration-step",children:[(0,V.jsx)(r.X6,{as:"h3",size:"md",children:"Data uses"}),(0,V.jsxs)(r.xv,{fontSize:"sm",children:["Data Uses describe the business purpose for which the personal data is processed or collected. Within a Data Use, you assign which categories of personal information are collected for this purpose and for which categories of data subjects. To update the available categories and uses, please visit"," ",(0,V.jsx)(l(),{href:"/taxonomy",passHref:!0,children:(0,V.jsx)(r.xv,{as:"a",color:"complimentary.600",children:"Manage taxonomy"})}),"."]}),u?(0,V.jsx)(j.$,{}):(0,V.jsx)(ie,ce({system:t,onCollision:function(){n((0,y.Vo)("A declaration already exists with that data use in this system. Please supply a different data use."))},onSave:f},d))]})},ue=n(32523),de=n(25646);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var me={description:"",fides_key:"",name:"",organization_fides_key:n(70889).Av,tags:[],system_type:"",privacy_declarations:[],data_responsibility_title:void 0,administrating_department:"",third_country_transfers:[],system_dependencies:[],joint_controller:{name:"",email:"",address:"",phone:""},data_protection_impact_assessment:{is_required:"false",progress:"",link:""}},ye=function(e){var t,n="true"===(null===(t=e.data_protection_impact_assessment)||void 0===t?void 0:t.is_required)?fe(fe({},e.data_protection_impact_assessment),{},{is_required:!0}):void 0,a=!!e.joint_controller&&!Object.values(e.joint_controller).every((function(e){return""===e}))?e.joint_controller:void 0;return{data_responsibility_title:e.data_responsibility_title,description:e.description,egress:e.egress,fides_key:e.fides_key,ingress:e.ingress,name:e.name,organization_fides_key:e.organization_fides_key,privacy_declarations:e.privacy_declarations,system_dependencies:e.system_dependencies,system_type:e.system_type,tags:e.tags,third_country_transfers:e.third_country_transfers,data_protection_impact_assessment:n,joint_controller:a,administrating_department:""===e.administrating_department?void 0:e.administrating_department}},he=n(79762),be=n(64656),ve=n(99429),xe=n(13230),ge=n(53652),je=(0,_.MM)(ge.y5),_e=function(e){var t,n=e.values,a=(0,T.u6)().initialValues,i=(0,p.C)(ue.cS),s=i?i.map((function(e){var t;return{label:null!==(t=e.name)&&void 0!==t?t:e.fides_key,value:e.fides_key}})):[];return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(M.VT,{id:"tags",name:"tags",label:"System Tags",options:a.tags?a.tags.map((function(e){return{value:e,label:e}})):[],tooltip:"Provide one or more tags to group the system. Tags are important as they allow you to filter and group systems for reporting and later review. Tags provide tremendous value as you scale - imagine you have thousands of systems, you\u2019re going to thank us later for tagging!",isMulti:!0}),(0,V.jsx)(M.AP,{label:"System dependencies",name:"system_dependencies",tooltip:"A list of fides keys to model dependencies.",options:s,isMulti:!0}),(0,V.jsx)(M.AP,{label:"Data responsibility title",name:"data_responsibility_title",options:je,tooltip:"An attribute to describe the role of responsibility over the personal data, used when exporting to a data map",isMulti:!1}),(0,V.jsx)(M.j0,{label:"Administrating department",name:"administrating_department",tooltip:"An optional value to identify the owning department or group of the system within your organization"}),(0,V.jsx)(M.AP,{name:"third_country_transfers",label:"Geographic location",tooltip:"An optional array to identify any third countries where data is transited to. For consistency purposes, these fields are required to follow the Alpha-3 code set in ISO 3166-1",isSearchable:!0,options:ve.Y,isMulti:!0}),(0,V.jsxs)(r.xu,{children:[(0,V.jsxs)(r.xu,{display:"flex",alignItems:"center",mb:4,children:[(0,V.jsx)(he.lX,{mb:0,children:"Joint controller"}),(0,V.jsx)(xe.Z,{label:"Contact information if a Joint Controller exists"})]}),(0,V.jsxs)(r.Kq,{ml:8,children:[(0,V.jsx)(M.j0,{label:"Name",name:"joint_controller.name"}),(0,V.jsx)(M.j0,{label:"Address",name:"joint_controller.address"}),(0,V.jsx)(M.j0,{label:"Email",name:"joint_controller.email"}),(0,V.jsx)(M.j0,{label:"Phone",name:"joint_controller.phone"})]})]}),(0,V.jsxs)(r.xu,{children:[(0,V.jsxs)(r.xu,{display:"flex",alignItems:"center",mb:4,children:[(0,V.jsx)(he.lX,{mb:0,children:"Data protection impact assessment"}),(0,V.jsx)(xe.Z,{label:"Contains information in regard to the data protection impact assessment exported on a data map or Record of Processing Activities (RoPA)."})]}),(0,V.jsxs)(r.Kq,{ml:8,children:[(0,V.jsx)(M.xt,{name:"data_protection_impact_assessment.is_required",label:"Is required",options:be.H}),"true"===(null===(t=n.data_protection_impact_assessment)||void 0===t?void 0:t.is_required)?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(M.j0,{label:"Progress",name:"data_protection_impact_assessment.progress",tooltip:"The optional status of a Data Protection Impact Assessment. Returned on an exported data map or RoPA."}),(0,V.jsx)(M.j0,{label:"Link",name:"data_protection_impact_assessment.link",tooltip:"The optional link to the Data Protection Impact Assessment. Returned on an exported data map or RoPA."})]}):null]})]})]})},we=Z.Ry().shape({name:Z.Z_().required().label("System name"),fides_key:Z.Z_().required().label("System key")}),Oe=function(e){var t,n=e.system,a=!n?"your new system":null!==(t=n.name)&&void 0!==t?t:"this system";return(0,V.jsxs)(r.X6,{as:"h3",size:"lg",children:["Describe ",a]})},De=function(e){var t=e.onSuccess,n=e.abridged,a=e.system,o=e.withHeader,c=e.children,l=(0,de.mZ)({resourceType:ge.P6.SYSTEM,resourceFidesKey:null===a||void 0===a?void 0:a.fides_key}),u=(0,d.useMemo)((function(){return a?function(e,t){var n=e.data_protection_impact_assessment;return fe(fe({},e),{},{data_protection_impact_assessment:fe(fe({},n),{},{is_required:null!==n&&void 0!==n&&n.is_required?"true":"false"}),customFieldValues:t})}(a,l.customFieldValues):me}),[a,l.customFieldValues]),f=(0,ue.f7)(),m=(0,v.Z)(f,2),y=m[0],b=m[1],x=(0,ue.qQ)(),j=(0,v.Z)(x,2),w=j[0],O=j[1],D=(0,p.C)(ue.cS),S=(0,d.useMemo)((function(){return Boolean(a&&(null===D||void 0===D?void 0:D.some((function(e){return e.fides_key===(null===a||void 0===a?void 0:a.fides_key)}))))}),[a,D]),k=(0,s.pm)(),P=function(){var e=(0,h.Z)(g().mark((function e(n,a){var r,i,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=ye(n),i=function(e){if((0,_.D4)(e)){var i=S?"editing":"creating",s=(0,_.e$)(e.error,"An unexpected error occurred while ".concat(i," the system. Please try again."));k({status:"error",description:s})}else k.closeAll(),a.resetForm({values:n}),t(r)},!S){e.next=8;break}return e.next=5,w(r);case 5:s=e.sent,e.next=11;break;case 8:return e.next=10,y(r);case 10:s=e.sent;case 11:return e.next=13,l.upsertCustomFields(n);case 13:i(s);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),C=O.isLoading||b.isLoading||l.isLoading;return(0,V.jsx)(T.J9,{initialValues:u,enableReinitialize:!0,onSubmit:P,validationSchema:we,children:function(e){var t=e.dirty,s=e.values,l=e.isValid;return(0,V.jsx)(T.l0,{children:(0,V.jsxs)(r.Kq,{spacing:6,children:[o?(0,V.jsx)(Oe,{system:a}):null,(0,V.jsx)(r.xv,{fontSize:"sm",children:"By providing a small amount of additional context for each system we can make reporting and understanding our tech stack much easier for everyone from engineering to legal teams. So let\u2019s do this now."}),(0,V.jsx)(r.X6,{as:"h4",size:"sm",children:"System details"}),(0,V.jsxs)(r.Kq,{spacing:4,children:[(0,V.jsxs)(r.Kq,{spacing:4,maxWidth:n?void 0:{base:"100%",lg:"50%"},children:[(0,V.jsx)(M.j0,{id:"name",name:"name",label:"System name",tooltip:"Give the system a unique, and relevant name for reporting purposes. e.g. \u201cEmail Data Warehouse\u201d",variant:"stacked"}),(0,V.jsx)(M.j0,{id:"fides_key",name:"fides_key",label:"System Fides key",disabled:S,tooltip:"A string token of your own invention that uniquely identifies this System. It's your responsibility to ensure that the value is unique across all of your System objects. The value may only contain alphanumeric characters, underscores, and hyphens. ([A-Za-z0-9_.-]).",variant:"stacked"}),(0,V.jsx)(M.j0,{id:"description",name:"description",label:"System description",tooltip:"If you wish you can provide a description which better explains the purpose of this system.",variant:"stacked"})]}),n?null:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(r.xu,{py:6,children:(0,V.jsx)(r.iz,{})}),(0,V.jsx)(_e,{values:s})]}),S&&(0,V.jsx)(de.uc,{resourceFidesKey:null===a||void 0===a?void 0:a.fides_key,resourceType:ge.P6.SYSTEM})]}),(0,V.jsx)(r.xu,{children:(0,V.jsx)(i.zx,{type:"submit",variant:"primary",size:"sm",isDisabled:C||!t||!l,isLoading:C,"data-testid":"save-btn",children:"Save"})}),c]})})}})},Se=function(e){var t=e.isUnmounting,n=e.onContinue,a=e.onCancel,i=(0,T.u6)().dirty,s=(0,z.qY)(),o=s.isOpen,c=s.onClose,l=s.onOpen;(0,d.useEffect)((function(){t&&i?l():n()}),[t,i,l,n]);return(0,V.jsx)(q.Z,{cancelButtonText:"Continue editing",continueButtonText:"Discard",isCentered:!0,isOpen:o,onClose:function(){a(),c()},onConfirm:n,title:"Unsaved changes",message:(0,V.jsx)(r.xv,{color:"gray.500",children:"You have unsaved changes, are you sure you want to discard?"})})};function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ce=function(e){var t=e.onViewDatamap,n=e.onAddPrivacyDeclaration,a={variant:"link",textDecor:"underline",textColor:"gray.700",fontWeight:"medium",display:"initial",cursor:"pointer"};return(0,V.jsxs)(r.xu,{children:[(0,V.jsx)(r.xv,{fontWeight:"700",children:"System has been saved successfully"}),(0,V.jsxs)(r.xv,{textColor:"gray.700",whiteSpace:"inherit",children:["Your system has been added to your data map. You can"," ",(0,V.jsx)(i.zx,Pe(Pe({as:"a",onClick:t},a),{},{whiteSpace:"inherit",children:"view it now"}))," ","and come back to finish this setup when you\u2019re ready. Or you can progress to"," ",(0,V.jsx)(i.zx,Pe(Pe({as:"a",onClick:n},a),{},{whiteSpace:"inherit",children:"adding your privacy declarations in the next tab"})),"."]})]})},Ae=function(e){var t=e.isCreate,n=(0,d.useState)(0),a=n[0],i=n[1],c=(0,d.useState)(void 0),h=c[0],b=c[1],v=(0,d.useState)(!1),x=v[0],g=v[1],j=(0,m.V)().systemOrDatamapRoute,_=(0,u.useRouter)(),w=(0,s.pm)(),O=(0,p.T)(),D=(0,p.C)(ue.NC);(0,d.useEffect)((function(){return t&&O((0,ue.db)(void 0)),function(){O((0,ue.db)(void 0))}}),[O,t]);var S=[{label:"System information",content:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(r.xu,{px:6,mb:9,children:(0,V.jsx)(De,{onSuccess:function(e){void 0===D&&g(!0),O((0,ue.db)(e));var t=Pe(Pe({},y.MA),{},{description:(0,V.jsx)(Ce,{onViewDatamap:function(){_.push(j).then((function(){w.closeAll()}))},onAddPrivacyDeclaration:function(){i(1),w.closeAll()}})});w(Pe({},t))},system:D,abridged:t,children:(0,V.jsx)(Se,{isUnmounting:void 0!==h,onContinue:function(){h&&(i(h),b(void 0))},onCancel:function(){return b(void 0)}})})}),x?(0,V.jsx)(r.xu,{backgroundColor:"gray.100",px:6,py:3,children:(0,V.jsxs)(r.xv,{color:"gray.500",fontSize:"sm","data-testid":"save-help-message",children:["Now that you have saved this new system it is"," ",(0,V.jsx)(l(),{href:j,passHref:!0,children:(0,V.jsx)(r.xv,{as:"a",textDecor:"underline",children:"ready to view in your data map"})}),". You can return to this setup at any time to add privacy declarations to this system."]})}):null]})},{label:"Data uses",content:D?(0,V.jsx)(r.xu,{px:6,width:{base:"100%",lg:"70%"},children:(0,V.jsx)(le,{system:D})}):null,isDisabled:!D},{label:"Data flow",content:D?(0,V.jsxs)(r.xu,{width:{base:"100%",lg:"70%"},children:[(0,V.jsxs)(r.xu,{px:6,paddingBottom:2,children:[(0,V.jsx)(r.xv,{fontSize:"md",lineHeight:6,fontWeight:"bold",marginBottom:3,children:"Data flow"}),(0,V.jsx)(r.xv,{fontSize:"sm",lineHeight:5,fontWeight:"medium",children:"Data flow describes the flow of data between systems in your Data Map. Below, you can configure Source and Destination systems and the corresponding links will be drawn in the Data Map graph. Source systems are systems that send data to this system while Destination systems receive data from this system."})]}),(0,V.jsx)(o.q,{system:D,isSystemTab:!0})]}):null,isDisabled:!D}];return(0,V.jsx)(f.Z,{data:S,"data-testid":"system-tabs",index:a,isLazy:!0,isManual:!0,onChange:function(e){0===e||1===e&&2===a||2===e&&1===a?i(e):b(e)}})}}}]);