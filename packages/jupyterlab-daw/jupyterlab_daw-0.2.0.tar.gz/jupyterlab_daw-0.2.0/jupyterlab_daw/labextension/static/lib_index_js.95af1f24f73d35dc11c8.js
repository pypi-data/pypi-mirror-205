"use strict";
(self["webpackChunkjupyterlab_daw"] = self["webpackChunkjupyterlab_daw"] || []).push([["lib_index_js"],{

/***/ "./style/icons/mute.svg":
/*!******************************!*\
  !*** ./style/icons/mute.svg ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<?xml version=\"1.0\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.0\" width=\"500\" height=\"500\" viewBox=\"0 0 75 75\"\nstroke=\"#111\" stroke-width=\"5\">\n  <g class=\"jp-icon3\" fill=\"#616161\" stroke=\"#616161\">\n    <path class=\"jp-icon3\" d=\"m39,14-17,15H6V48H22l17,15z\" stroke-linejoin=\"round\"/>\n  </g>\n  <g class=\"jp-icon3\" stroke=\"#616161\">\n    <path class=\"jp-icon3\" d=\"m49,26 20,24m0-24-20,24\" fill=\"none\" stroke-linecap=\"round\"/>\n  </g>\n</svg>\n");

/***/ }),

/***/ "./style/icons/pause.svg":
/*!*******************************!*\
  !*** ./style/icons/pause.svg ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg\n   version=\"1.0\"\n   width=\"500\"\n   height=\"500\"\n   viewBox=\"0 0 75 75\"\n   xmlns=\"http://www.w3.org/2000/svg\">\n  <g class=\"jp-icon3\" fill=\"#616161\" stroke=\"#616161\">\n    <path\n       d=\"m 30,15.000037 -15.000001,-5e-5 0.317797,45.000025 H 30 Z\"\n       style=\"stroke-width:5;stroke-linejoin:round\" />\n    <path\n       d=\"m 60,15.000037 -15.158899,-5e-5 0.317797,45.000025 H 60 Z\"\n       style=\"stroke-width:5;stroke-linejoin:round\" />\n  </g>\n</svg>\n");

/***/ }),

/***/ "./style/icons/play.svg":
/*!******************************!*\
  !*** ./style/icons/play.svg ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg\n   version=\"1.0\"\n   width=\"500\"\n   height=\"500\"\n   viewBox=\"0 0 75 75\"\n   xmlns=\"http://www.w3.org/2000/svg\">\n  <g class=\"jp-icon3\" fill=\"#616161\" stroke=\"#616161\">\n    <path\n       d=\"m 59.999999,37.5 -45,-22.500013 0.317797,45.000025 z\"\n       style=\"stroke-width:5;stroke-linejoin:round\" />\n  </g>\n</svg>\n");

/***/ }),

/***/ "./style/icons/speaker.svg":
/*!*********************************!*\
  !*** ./style/icons/speaker.svg ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.0\" width=\"500\" height=\"500\" viewBox=\"0 0 75 75\">\n  <g class=\"jp-icon3\" fill=\"#616161\" stroke=\"#616161\">\n    <path d=\"M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z\" style=\"stroke-width:5;stroke-linejoin:round;\"/>\n  </g>\n  <g class=\"jp-icon3\" stroke=\"#616161\">\n    <path class=\"jp-icon3\" d=\"M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6\" style=\"fill:none;stroke-width:5;stroke-linecap:round\"/>\n  </g>\n</svg>\n");

/***/ }),

/***/ "./style/icons/stop.svg":
/*!******************************!*\
  !*** ./style/icons/stop.svg ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ("<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg\n   version=\"1.0\"\n   width=\"500\"\n   height=\"500\"\n   viewBox=\"0 0 75 75\"\n   xmlns=\"http://www.w3.org/2000/svg\">\n  <g class=\"jp-icon3\" fill=\"#616161\" stroke=\"#616161\">\n    <path\n       d=\"m 59.999999,15.000037 -45,-5e-5 0.317797,45.000025 h 44.682203 z\"\n       style=\"stroke-width:5;stroke-linejoin:round\" />\n  </g>\n</svg>\n");

/***/ }),

/***/ "./lib/commands.js":
/*!*************************!*\
  !*** ./lib/commands.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "addCommands": () => (/* binding */ addCommands)
/* harmony export */ });
/* harmony import */ var _tokens__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./tokens */ "./lib/tokens.js");

function addCommands(app, palette, dawModel) {
    /** Mute / Unmute main output (speakers). */
    app.commands.addCommand(_tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawToggleDestinationMute, {
        label: 'Mute / Unmute Main Output',
        execute: () => dawModel.toggleMuteDestination()
    });
    /** Start transport. */
    app.commands.addCommand(_tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawTransportStart, {
        label: 'Start Transport',
        execute: () => dawModel.transportStart()
    });
    /** Pause transport. */
    app.commands.addCommand(_tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawTransportPause, {
        label: 'Pause Transport',
        execute: () => dawModel.transportPause()
    });
    /** Stop transport. */
    app.commands.addCommand(_tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawTransportStop, {
        label: 'Stop Transport',
        execute: () => dawModel.transportStop()
    });
    if (palette !== null) {
        palette.addItem({
            command: _tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawToggleDestinationMute,
            category: 'DAW'
        });
        palette.addItem({
            command: _tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawTransportStart,
            category: 'DAW'
        });
        palette.addItem({
            command: _tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawTransportPause,
            category: 'DAW'
        });
        palette.addItem({
            command: _tokens__WEBPACK_IMPORTED_MODULE_0__.CommandIDs.dawTransportStop,
            category: 'DAW'
        });
    }
}


/***/ }),

/***/ "./lib/components/meter.js":
/*!*********************************!*\
  !*** ./lib/components/meter.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "Meter": () => (/* binding */ Meter)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tone */ "webpack/sharing/consume/default/tone/tone");
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _util_animation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/animation */ "./lib/util/animation.js");



/**
 * Audio meter visualizer.
 */
const Meter = ({ inputNode, width, height, color1 = 'lime', color2 = 'red', orientation = 'vertical', fps = 30, thresholdValue = 0.01, enabled = true }) => {
    const meterRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(new tone__WEBPACK_IMPORTED_MODULE_1__.Meter({ normalRange: true, channels: 2 }));
    const canvasRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);
    const gradientRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)('lime');
    const extentRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(width);
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
        if (canvasRef.current) {
            const ctx = canvasRef.current.getContext('2d');
            if (ctx) {
                let grd;
                if (orientation === 'horizontal') {
                    grd = ctx.createLinearGradient(0, 0, width, 0);
                }
                else {
                    grd = ctx.createLinearGradient(0, height, 0, 0);
                }
                grd.addColorStop(0, color1);
                grd.addColorStop(0.5, color1);
                grd.addColorStop(1, color2);
                gradientRef.current = grd;
            }
        }
        if (orientation === 'horizontal') {
            extentRef.current = width;
        }
        else {
            extentRef.current = height;
        }
    }, [width, height, color1, color2, orientation]);
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
        const meter = meterRef.current;
        // TODO: use smoothing with next Tone.js release version
        // https://github.com/Tonejs/Tone.js/issues/882
        meter.smoothing = 0;
        // display 2 channels even when a mono signal goes through destination
        meter.channelCountMode = 'explicit';
        return () => {
            meter.dispose();
        };
    }, []);
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
        const meter = meterRef.current;
        if (enabled) {
            inputNode.connect(meter);
        }
        return () => {
            if (enabled) {
                inputNode.disconnect(meter);
            }
        };
    }, [inputNode, enabled, fps]);
    const render = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((ctx) => {
        ctx.clearRect(0, 0, width, height);
        const valueLR = meterRef.current.getValue();
        const thresh = thresholdValue;
        if (valueLR[0] < thresh && valueLR[1] < thresh) {
            return;
        }
        const extent = extentRef.current;
        const levelL = Math.round(Math.pow(valueLR[0], 0.2) * extent);
        const levelR = Math.round(Math.pow(valueLR[1], 0.2) * extent);
        ctx.fillStyle = gradientRef.current;
        if (orientation === 'horizontal') {
            ctx.fillRect(0, 0, levelL, height / 2);
            ctx.fillRect(0, height / 2, levelR, height);
        }
        else {
            ctx.fillRect(0, height, width / 2, -levelL);
            ctx.fillRect(width / 2, height, width, -levelR);
        }
    }, [width, height, orientation, thresholdValue]);
    (0,_util_animation__WEBPACK_IMPORTED_MODULE_2__.useAnimationFrame)(() => {
        if (canvasRef.current) {
            const context = canvasRef.current.getContext('2d');
            if (context) {
                render(context);
            }
        }
    }, fps, enabled);
    return (react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null,
        react__WEBPACK_IMPORTED_MODULE_0___default().createElement("canvas", { ref: canvasRef, height: height, width: width })));
};


/***/ }),

/***/ "./lib/components/transport.js":
/*!*************************************!*\
  !*** ./lib/components/transport.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "TransportPosition": () => (/* binding */ TransportPosition)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tone */ "webpack/sharing/consume/default/tone/tone");
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _util_draw__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/draw */ "./lib/util/draw.js");



function getTransportPosition() {
    const pos = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)().position.toString();
    return pos.substr(0, pos.lastIndexOf(':')) + ':0';
}
const TransportPosition = ({ state = 'stopped', dirtyClassName = '' }) => {
    const [position, setPosition] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(getTransportPosition());
    const [dirty, setDirty] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
    // make sure to reset the input value when transport is stopped
    // reset dirty when transport is started or stopped
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
        if (state === 'stopped') {
            setPosition(getTransportPosition());
            setDirty(false);
        }
        else if (state === 'started') {
            setDirty(false);
        }
    }, [state]);
    const setPositionClb = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
        setPosition(getTransportPosition());
    }, []);
    (0,_util_draw__WEBPACK_IMPORTED_MODULE_2__.useTransportDraw)(setPositionClb, '4n');
    const handleChange = (event) => {
        const value = event.target.value;
        setPosition(value);
        setDirty(true);
    };
    const handleKeyDown = (event) => {
        if (event.key === 'Enter') {
            (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)().position = position;
            // update input value with reformatted position
            setPosition(getTransportPosition());
            setDirty(false);
        }
    };
    return (react__WEBPACK_IMPORTED_MODULE_0___default().createElement("input", { type: "text", className: dirty ? dirtyClassName : '', disabled: state === 'started', value: position, onChange: handleChange, onKeyDown: handleKeyDown }));
};


/***/ }),

/***/ "./lib/iconimports.js":
/*!****************************!*\
  !*** ./lib/iconimports.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "muteIcon": () => (/* binding */ muteIcon),
/* harmony export */   "pauseIcon": () => (/* binding */ pauseIcon),
/* harmony export */   "playIcon": () => (/* binding */ playIcon),
/* harmony export */   "speakerIcon": () => (/* binding */ speakerIcon),
/* harmony export */   "stopIcon": () => (/* binding */ stopIcon)
/* harmony export */ });
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/ui-components */ "webpack/sharing/consume/default/@jupyterlab/ui-components");
/* harmony import */ var _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _style_icons_speaker_svg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../style/icons/speaker.svg */ "./style/icons/speaker.svg");
/* harmony import */ var _style_icons_mute_svg__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../style/icons/mute.svg */ "./style/icons/mute.svg");
/* harmony import */ var _style_icons_play_svg__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../style/icons/play.svg */ "./style/icons/play.svg");
/* harmony import */ var _style_icons_pause_svg__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../style/icons/pause.svg */ "./style/icons/pause.svg");
/* harmony import */ var _style_icons_stop_svg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../style/icons/stop.svg */ "./style/icons/stop.svg");






const speakerIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__.LabIcon({
    name: 'daw:speaker',
    svgstr: _style_icons_speaker_svg__WEBPACK_IMPORTED_MODULE_1__["default"]
});
const muteIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__.LabIcon({
    name: 'daw:mute',
    svgstr: _style_icons_mute_svg__WEBPACK_IMPORTED_MODULE_2__["default"]
});
const playIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__.LabIcon({
    name: 'daw:play',
    svgstr: _style_icons_play_svg__WEBPACK_IMPORTED_MODULE_3__["default"]
});
const pauseIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__.LabIcon({
    name: 'daw:pause',
    svgstr: _style_icons_pause_svg__WEBPACK_IMPORTED_MODULE_4__["default"]
});
const stopIcon = new _jupyterlab_ui_components__WEBPACK_IMPORTED_MODULE_0__.LabIcon({
    name: 'daw:stop',
    svgstr: _style_icons_stop_svg__WEBPACK_IMPORTED_MODULE_5__["default"]
});


/***/ }),

/***/ "./lib/index.js":
/*!**********************!*\
  !*** ./lib/index.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "IDawExtension": () => (/* reexport safe */ _tokens__WEBPACK_IMPORTED_MODULE_1__.IDawExtension),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _widgets__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./widgets */ "./lib/widgets/topbar.js");
/* harmony import */ var _commands__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commands */ "./lib/commands.js");
/* harmony import */ var _model__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./model */ "./lib/model.js");
/* harmony import */ var _tokens__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tokens */ "./lib/tokens.js");






/**
 * Initialization data for the jupyterlab-daw extension.
 */
const plugin = {
    id: 'jupyterlab-daw:plugin',
    autoStart: true,
    optional: [_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ICommandPalette],
    provides: _tokens__WEBPACK_IMPORTED_MODULE_1__.IDawExtension,
    activate: (app, palette) => {
        const dawExtension = new _model__WEBPACK_IMPORTED_MODULE_2__.DawExtension();
        (0,_commands__WEBPACK_IMPORTED_MODULE_3__.addCommands)(app, palette, dawExtension);
        const topBar = new _widgets__WEBPACK_IMPORTED_MODULE_4__.TopBar(dawExtension, app.commands);
        topBar.id = 'jp-daw-topbar';
        app.shell.add(topBar, 'top', { rank: 1000 });
        return dawExtension;
    }
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (plugin);


/***/ }),

/***/ "./lib/model.js":
/*!**********************!*\
  !*** ./lib/model.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "DawExtension": () => (/* binding */ DawExtension)
/* harmony export */ });
/* harmony import */ var _lumino_signaling__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @lumino/signaling */ "webpack/sharing/consume/default/@lumino/signaling");
/* harmony import */ var _lumino_signaling__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lumino_signaling__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tone */ "webpack/sharing/consume/default/tone/tone");
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_1__);


class DawExtension {
    constructor() {
        this._isDisposed = false;
        this._destinationChanged = new _lumino_signaling__WEBPACK_IMPORTED_MODULE_0__.Signal(this);
        this._transportChanged = new _lumino_signaling__WEBPACK_IMPORTED_MODULE_0__.Signal(this);
        const transport = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)();
        this._transportClb = () => { this._transportChanged.emit(); };
        transport.on('start', this._transportClb);
        transport.on('pause', this._transportClb);
        transport.on('stop', this._transportClb);
    }
    /**
     * Signal emitted when the state of the destination node (speakers)
     * is changed.
     */
    get destinationChanged() {
        return this._destinationChanged;
    }
    /**
     * Proxy for the destination node (speakers) mute.
     */
    get destinationMute() {
        return (0,tone__WEBPACK_IMPORTED_MODULE_1__.getDestination)().mute;
    }
    /**
     * Mute or unmute the destination node (speakers).
     */
    toggleMuteDestination() {
        const dest = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getDestination)();
        dest.mute = !dest.mute;
        this._destinationChanged.emit();
    }
    /**
     * A signal emitted whenever the state of Tonejs Transport
     * changes.
     */
    get transportChanged() {
        return this._transportChanged;
    }
    /**
     * Current Tonejs transport state
     */
    get transportState() {
        return (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)().state;
    }
    /**
     * Start Tone transport
     */
    transportStart() {
        const transport = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)();
        if (transport.state !== 'started') {
            // start transport inactive if context not started
            (0,tone__WEBPACK_IMPORTED_MODULE_1__.start)();
            transport.start();
            this._transportChanged.emit();
        }
    }
    /**
     * Pause Tone transport
     */
    transportPause() {
        const transport = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)();
        if (transport.state === 'started') {
            transport.pause();
            this._transportChanged.emit();
        }
    }
    /**
     * Stop Tone transport
     */
    transportStop() {
        const transport = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)();
        if (transport.state !== 'stopped') {
            transport.stop();
            this._transportChanged.emit();
        }
    }
    /**
     * Boolean indicating whether the model has been disposed.
     */
    get isDisposed() {
        return this._isDisposed;
    }
    /**
     * Dispose model ressources and unbind tone signal callbacks.
     */
    dispose() {
        if (this.isDisposed) {
            return;
        }
        _lumino_signaling__WEBPACK_IMPORTED_MODULE_0__.Signal.clearData(this);
        const transport = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)();
        transport.off('start', this._transportClb);
        transport.off('pause', this._transportClb);
        transport.off('stop', this._transportClb);
        this._isDisposed = true;
    }
}


/***/ }),

/***/ "./lib/tokens.js":
/*!***********************!*\
  !*** ./lib/tokens.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "CommandIDs": () => (/* binding */ CommandIDs),
/* harmony export */   "EXTENSION_ID": () => (/* binding */ EXTENSION_ID),
/* harmony export */   "IDawExtension": () => (/* binding */ IDawExtension)
/* harmony export */ });
/* harmony import */ var _lumino_coreutils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @lumino/coreutils */ "webpack/sharing/consume/default/@lumino/coreutils");
/* harmony import */ var _lumino_coreutils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lumino_coreutils__WEBPACK_IMPORTED_MODULE_0__);

const EXTENSION_ID = 'jupyter.extensions.daw_plugin';
const IDawExtension = new _lumino_coreutils__WEBPACK_IMPORTED_MODULE_0__.Token(EXTENSION_ID);
/**
 * The command IDs used by the daw plugin.
 */
var CommandIDs;
(function (CommandIDs) {
    CommandIDs["dawToggleDestinationMute"] = "daw:toggle-main-mute";
    CommandIDs["dawTransportStart"] = "daw:transport-start";
    CommandIDs["dawTransportPause"] = "daw:transport-pause";
    CommandIDs["dawTransportStop"] = "daw:transport-stop";
})(CommandIDs || (CommandIDs = {}));


/***/ }),

/***/ "./lib/util/animation.js":
/*!*******************************!*\
  !*** ./lib/util/animation.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "useAnimationFrame": () => (/* binding */ useAnimationFrame)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);

/**
 * Reusable React Hook for setting animation frames.
 *
 * @param callback - function called at each frame (fps) render
 * @param fps {number} - allow executing the callback less often than the screen refresh rate
 * @param running {boolean=} - changing the state will either start or stop the animation
 *
 */
const useAnimationFrame = (callback, fps, running = true) => {
    const frameRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
    const prevRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(-1);
    const animate = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
        const now = performance.now();
        const delta = now - prevRef.current;
        if (prevRef.current === -1 || delta >= 1000 / fps) {
            callback();
            prevRef.current = now;
        }
        frameRef.current = requestAnimationFrame(animate);
    }, [callback, fps]);
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
        if (running) {
            frameRef.current = requestAnimationFrame(animate);
        }
        return () => {
            // delay stopping the animation (draw next 10 actual frames) so that
            // it has a chance to clear or reset properly.
            if (running) {
                setTimeout(() => {
                    cancelAnimationFrame(frameRef.current);
                }, 10000 / fps);
            }
        };
    }, [running, fps, animate]);
};


/***/ }),

/***/ "./lib/util/draw.js":
/*!**************************!*\
  !*** ./lib/util/draw.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "useTransportDraw": () => (/* binding */ useTransportDraw)
/* harmony export */ });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tone */ "webpack/sharing/consume/default/tone/tone");
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_1__);


/**
 * React hook for Tone transport synced animations.
 */
const useTransportDraw = (callback, interval) => {
    const eventIDRef = (0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(-1);
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
        const transport = (0,tone__WEBPACK_IMPORTED_MODULE_1__.getTransport)();
        const drawCallback = (time) => {
            (0,tone__WEBPACK_IMPORTED_MODULE_1__.getDraw)().schedule(callback, time);
        };
        eventIDRef.current = transport.scheduleRepeat(drawCallback, interval);
        return () => {
            transport.clear(eventIDRef.current);
        };
    }, [interval, callback]);
};


/***/ }),

/***/ "./lib/widgets/topbar.js":
/*!*******************************!*\
  !*** ./lib/widgets/topbar.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "TopBar": () => (/* binding */ TopBar)
/* harmony export */ });
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @jupyterlab/apputils */ "webpack/sharing/consume/default/@jupyterlab/apputils");
/* harmony import */ var _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ "webpack/sharing/consume/default/react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tone */ "webpack/sharing/consume/default/tone/tone");
/* harmony import */ var tone__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(tone__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _components_meter__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../components/meter */ "./lib/components/meter.js");
/* harmony import */ var _components_transport__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../components/transport */ "./lib/components/transport.js");
/* harmony import */ var _iconimports__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../iconimports */ "./lib/iconimports.js");
/* harmony import */ var _tokens__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../tokens */ "./lib/tokens.js");







const TOPBAR_CLASS = 'jp-daw-TopBar';
const CONTENT_CLASS = 'jp-daw-TopBar-item';
class TopBar extends _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.Toolbar {
    constructor(model, commands) {
        super();
        this._model = model;
        this.addClass(TOPBAR_CLASS);
        const playButton = _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ReactWidget.create(react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.UseSignal, { signal: model.transportChanged }, () => (react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ToolbarButtonComponent, { icon: _iconimports__WEBPACK_IMPORTED_MODULE_3__.playIcon, pressedIcon: _iconimports__WEBPACK_IMPORTED_MODULE_3__.pauseIcon, pressed: model.transportState === 'started', tooltip: 'start transport', pressedTooltip: 'pause transport', onClick: () => {
                if (model.transportState === 'started') {
                    commands.execute(_tokens__WEBPACK_IMPORTED_MODULE_4__.CommandIDs.dawTransportPause);
                }
                else {
                    commands.execute(_tokens__WEBPACK_IMPORTED_MODULE_4__.CommandIDs.dawTransportStart);
                }
            } }))));
        this.addItem('jp-daw-topbar-play', playButton);
        const stopButton = _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ReactWidget.create(react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.UseSignal, { signal: model.transportChanged }, () => (react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ToolbarButtonComponent, { icon: _iconimports__WEBPACK_IMPORTED_MODULE_3__.stopIcon, tooltip: 'stop transport', onClick: () => {
                commands.execute(_tokens__WEBPACK_IMPORTED_MODULE_4__.CommandIDs.dawTransportStop);
            } }))));
        this.addItem('jp-daw-topbar-stop', stopButton);
        const transportPosition = _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ReactWidget.create(react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.UseSignal, { signal: model.transportChanged }, () => (react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_components_transport__WEBPACK_IMPORTED_MODULE_5__.TransportPosition, { state: model.transportState, dirtyClassName: 'jp-daw-mod-dirty' }))));
        transportPosition.addClass('jp-daw-TransportPosition');
        this.addItem('jp-daw-topbar-transport-position', transportPosition);
        const meter = _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ReactWidget.create(react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.UseSignal, { signal: model.destinationChanged }, () => (react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_components_meter__WEBPACK_IMPORTED_MODULE_6__.Meter, { inputNode: (0,tone__WEBPACK_IMPORTED_MODULE_2__.getDestination)(), width: 16, height: 21, fps: 20, orientation: 'vertical', enabled: !this._model.destinationMute }))));
        meter.addClass('jp-daw-Meter');
        this.addItem('jp-daw-topbar-meter', meter);
        const toggleMuteButton = _jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ReactWidget.create(react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.UseSignal, { signal: model.destinationChanged }, () => (react__WEBPACK_IMPORTED_MODULE_1___default().createElement(_jupyterlab_apputils__WEBPACK_IMPORTED_MODULE_0__.ToolbarButtonComponent, { icon: _iconimports__WEBPACK_IMPORTED_MODULE_3__.speakerIcon, pressedIcon: _iconimports__WEBPACK_IMPORTED_MODULE_3__.muteIcon, pressed: this._model.destinationMute, tooltip: 'mute', pressedTooltip: 'unmute', onClick: () => {
                commands.execute(_tokens__WEBPACK_IMPORTED_MODULE_4__.CommandIDs.dawToggleDestinationMute);
            } }))));
        this.addItem('jp-daw-topbar-toggle-mute', toggleMuteButton);
    }
    addItem(name, item) {
        item.addClass(CONTENT_CLASS);
        return super.addItem(name, item);
    }
}


/***/ })

}]);
//# sourceMappingURL=lib_index_js.95af1f24f73d35dc11c8.js.map