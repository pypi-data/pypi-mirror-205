"use strict";(self.webpackChunkjupyterlab_daw=self.webpackChunkjupyterlab_daw||[]).push([[234],{234:(t,e,n)=>{n.r(e),n.d(e,{IDawExtension:()=>w,default:()=>b});var a=n(33),s=n(271),o=n.n(s),r=n(363);const i=({inputNode:t,width:e,height:n,color1:a="lime",color2:i="red",orientation:d="vertical",fps:l=30,thresholdValue:p=.01,enabled:c=!0})=>{const u=(0,s.useRef)(new r.Meter({normalRange:!0,channels:2})),g=(0,s.useRef)(null),m=(0,s.useRef)("lime"),h=(0,s.useRef)(e);(0,s.useEffect)((()=>{if(g.current){const t=g.current.getContext("2d");if(t){let s;s="horizontal"===d?t.createLinearGradient(0,0,e,0):t.createLinearGradient(0,n,0,0),s.addColorStop(0,a),s.addColorStop(.5,a),s.addColorStop(1,i),m.current=s}}h.current="horizontal"===d?e:n}),[e,n,a,i,d]),(0,s.useEffect)((()=>{const t=u.current;return t.smoothing=0,t.channelCountMode="explicit",()=>{t.dispose()}}),[]),(0,s.useEffect)((()=>{const e=u.current;return c&&t.connect(e),()=>{c&&t.disconnect(e)}}),[t,c,l]);const w=(0,s.useCallback)((t=>{t.clearRect(0,0,e,n);const a=u.current.getValue(),s=p;if(a[0]<s&&a[1]<s)return;const o=h.current,r=Math.round(Math.pow(a[0],.2)*o),i=Math.round(Math.pow(a[1],.2)*o);t.fillStyle=m.current,"horizontal"===d?(t.fillRect(0,0,r,n/2),t.fillRect(0,n/2,i,n)):(t.fillRect(0,n,e/2,-r),t.fillRect(e/2,n,e,-i))}),[e,n,d,p]);return((t,e,n=!0)=>{const a=(0,s.useRef)(0),o=(0,s.useRef)(-1),r=(0,s.useCallback)((()=>{const n=performance.now(),s=n-o.current;(-1===o.current||s>=1e3/e)&&(t(),o.current=n),a.current=requestAnimationFrame(r)}),[t,e]);(0,s.useEffect)((()=>(n&&(a.current=requestAnimationFrame(r)),()=>{n&&setTimeout((()=>{cancelAnimationFrame(a.current)}),1e4/e)})),[n,e,r])})((()=>{if(g.current){const t=g.current.getContext("2d");t&&w(t)}}),l,c),o().createElement("div",null,o().createElement("canvas",{ref:g,height:n,width:e}))};function d(){const t=(0,r.getTransport)().position.toString();return t.substr(0,t.lastIndexOf(":"))+":0"}const l=({state:t="stopped",dirtyClassName:e=""})=>{const[n,a]=(0,s.useState)(d()),[i,l]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{"stopped"===t?(a(d()),l(!1)):"started"===t&&l(!1)}),[t]),((t,e)=>{const n=(0,s.useRef)(-1);(0,s.useEffect)((()=>{const e=(0,r.getTransport)();return n.current=e.scheduleRepeat((e=>{(0,r.getDraw)().schedule(t,e)}),"4n"),()=>{e.clear(n.current)}}),["4n",t])})((0,s.useCallback)((()=>{a(d())}),[])),o().createElement("input",{type:"text",className:i?e:"",disabled:"started"===t,value:n,onChange:t=>{const e=t.target.value;a(e),l(!0)},onKeyDown:t=>{"Enter"===t.key&&((0,r.getTransport)().position=n,a(d()),l(!1))}})};var p=n(502);const c=new p.LabIcon({name:"daw:speaker",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="500" height="500" viewBox="0 0 75 75">\n  <g class="jp-icon3" fill="#616161" stroke="#616161">\n    <path d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z" style="stroke-width:5;stroke-linejoin:round;"/>\n  </g>\n  <g class="jp-icon3" stroke="#616161">\n    <path class="jp-icon3" d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6" style="fill:none;stroke-width:5;stroke-linecap:round"/>\n  </g>\n</svg>\n'}),u=new p.LabIcon({name:"daw:mute",svgstr:'<?xml version="1.0"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="500" height="500" viewBox="0 0 75 75"\nstroke="#111" stroke-width="5">\n  <g class="jp-icon3" fill="#616161" stroke="#616161">\n    <path class="jp-icon3" d="m39,14-17,15H6V48H22l17,15z" stroke-linejoin="round"/>\n  </g>\n  <g class="jp-icon3" stroke="#616161">\n    <path class="jp-icon3" d="m49,26 20,24m0-24-20,24" fill="none" stroke-linecap="round"/>\n  </g>\n</svg>\n'}),g=new p.LabIcon({name:"daw:play",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   version="1.0"\n   width="500"\n   height="500"\n   viewBox="0 0 75 75"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161" stroke="#616161">\n    <path\n       d="m 59.999999,37.5 -45,-22.500013 0.317797,45.000025 z"\n       style="stroke-width:5;stroke-linejoin:round" />\n  </g>\n</svg>\n'}),m=new p.LabIcon({name:"daw:pause",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   version="1.0"\n   width="500"\n   height="500"\n   viewBox="0 0 75 75"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161" stroke="#616161">\n    <path\n       d="m 30,15.000037 -15.000001,-5e-5 0.317797,45.000025 H 30 Z"\n       style="stroke-width:5;stroke-linejoin:round" />\n    <path\n       d="m 60,15.000037 -15.158899,-5e-5 0.317797,45.000025 H 60 Z"\n       style="stroke-width:5;stroke-linejoin:round" />\n  </g>\n</svg>\n'}),h=new p.LabIcon({name:"daw:stop",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   version="1.0"\n   width="500"\n   height="500"\n   viewBox="0 0 75 75"\n   xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161" stroke="#616161">\n    <path\n       d="m 59.999999,15.000037 -45,-5e-5 0.317797,45.000025 h 44.682203 z"\n       style="stroke-width:5;stroke-linejoin:round" />\n  </g>\n</svg>\n'}),w=new(n(526).Token)("jupyter.extensions.daw_plugin");var f;!function(t){t.dawToggleDestinationMute="daw:toggle-main-mute",t.dawTransportStart="daw:transport-start",t.dawTransportPause="daw:transport-pause",t.dawTransportStop="daw:transport-stop"}(f||(f={}));class C extends a.Toolbar{constructor(t,e){super(),this._model=t,this.addClass("jp-daw-TopBar");const n=a.ReactWidget.create(o().createElement(a.UseSignal,{signal:t.transportChanged},(()=>o().createElement(a.ToolbarButtonComponent,{icon:g,pressedIcon:m,pressed:"started"===t.transportState,tooltip:"start transport",pressedTooltip:"pause transport",onClick:()=>{"started"===t.transportState?e.execute(f.dawTransportPause):e.execute(f.dawTransportStart)}}))));this.addItem("jp-daw-topbar-play",n);const s=a.ReactWidget.create(o().createElement(a.UseSignal,{signal:t.transportChanged},(()=>o().createElement(a.ToolbarButtonComponent,{icon:h,tooltip:"stop transport",onClick:()=>{e.execute(f.dawTransportStop)}}))));this.addItem("jp-daw-topbar-stop",s);const d=a.ReactWidget.create(o().createElement(a.UseSignal,{signal:t.transportChanged},(()=>o().createElement(l,{state:t.transportState,dirtyClassName:"jp-daw-mod-dirty"}))));d.addClass("jp-daw-TransportPosition"),this.addItem("jp-daw-topbar-transport-position",d);const p=a.ReactWidget.create(o().createElement(a.UseSignal,{signal:t.destinationChanged},(()=>o().createElement(i,{inputNode:(0,r.getDestination)(),width:16,height:21,fps:20,orientation:"vertical",enabled:!this._model.destinationMute}))));p.addClass("jp-daw-Meter"),this.addItem("jp-daw-topbar-meter",p);const w=a.ReactWidget.create(o().createElement(a.UseSignal,{signal:t.destinationChanged},(()=>o().createElement(a.ToolbarButtonComponent,{icon:c,pressedIcon:u,pressed:this._model.destinationMute,tooltip:"mute",pressedTooltip:"unmute",onClick:()=>{e.execute(f.dawToggleDestinationMute)}}))));this.addItem("jp-daw-topbar-toggle-mute",w)}addItem(t,e){return e.addClass("jp-daw-TopBar-item"),super.addItem(t,e)}}var v=n(840);class T{constructor(){this._isDisposed=!1,this._destinationChanged=new v.Signal(this),this._transportChanged=new v.Signal(this);const t=(0,r.getTransport)();this._transportClb=()=>{this._transportChanged.emit()},t.on("start",this._transportClb),t.on("pause",this._transportClb),t.on("stop",this._transportClb)}get destinationChanged(){return this._destinationChanged}get destinationMute(){return(0,r.getDestination)().mute}toggleMuteDestination(){const t=(0,r.getDestination)();t.mute=!t.mute,this._destinationChanged.emit()}get transportChanged(){return this._transportChanged}get transportState(){return(0,r.getTransport)().state}transportStart(){const t=(0,r.getTransport)();"started"!==t.state&&((0,r.start)(),t.start(),this._transportChanged.emit())}transportPause(){const t=(0,r.getTransport)();"started"===t.state&&(t.pause(),this._transportChanged.emit())}transportStop(){const t=(0,r.getTransport)();"stopped"!==t.state&&(t.stop(),this._transportChanged.emit())}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed)return;v.Signal.clearData(this);const t=(0,r.getTransport)();t.off("start",this._transportClb),t.off("pause",this._transportClb),t.off("stop",this._transportClb),this._isDisposed=!0}}const b={id:"jupyterlab-daw:plugin",autoStart:!0,optional:[a.ICommandPalette],provides:w,activate:(t,e)=>{const n=new T;!function(t,e,n){t.commands.addCommand(f.dawToggleDestinationMute,{label:"Mute / Unmute Main Output",execute:()=>n.toggleMuteDestination()}),t.commands.addCommand(f.dawTransportStart,{label:"Start Transport",execute:()=>n.transportStart()}),t.commands.addCommand(f.dawTransportPause,{label:"Pause Transport",execute:()=>n.transportPause()}),t.commands.addCommand(f.dawTransportStop,{label:"Stop Transport",execute:()=>n.transportStop()}),null!==e&&(e.addItem({command:f.dawToggleDestinationMute,category:"DAW"}),e.addItem({command:f.dawTransportStart,category:"DAW"}),e.addItem({command:f.dawTransportPause,category:"DAW"}),e.addItem({command:f.dawTransportStop,category:"DAW"}))}(t,e,n);const a=new C(n,t.commands);return a.id="jp-daw-topbar",t.shell.add(a,"top",{rank:1e3}),n}}}}]);